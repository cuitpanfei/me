<!doctype html><html lang=zh-CN><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=UTF-8><meta name=generator content="Hugo 0.150.0"><meta name=theme-color content="#fff"><meta name=color-scheme content="light dark"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><title>Sentinel--服务容错 | CUITPF</title><link rel=stylesheet href=/me/css/meme.min.cbd81620011471fb10bc2567684a9b81857dd80016bdcd67ea67d07147549ad3.css><script src=/me/js/meme.min.60c9607187770974b0557afb656b9af66524f1e2b096396869a2dc23e13bde45.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&amp;family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&amp;family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap"></noscript><meta name=author content="cuitpanfei"><meta name=description content="微服务
高并发带来的问题 在微服务架构中，我们将业务拆分成一个个的服务，服务与服务之间可以相互调用，但是由于网络原因 或者自身的原因，服务并不能保证服务的100%可用，如果单个服务出现问题，调用这个服务就会出现 网络延迟，此时若有大量的网络涌入，会形成任务堆积，最终导致服务瘫痪。
"><link rel="shortcut icon" type=image/x-icon href=/me/favicon.ico><link rel=icon type=image/svg+xml href=/me/icons/favicon.svg><link rel=icon type=image/png href=/me/icons/favicon-96x96.png sizes=96x96><link rel=apple-touch-icon href=/me/icons/apple-touch-icon.png sizes=180x180><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="CUITPF"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="CUITPF"><link rel=manifest href=/me/manifest.json><link rel=canonical href=https://cuitpanfei.github.io/me/posts/post-305/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2021-01-29T13:57:00+00:00","dateModified":"2025-09-14T03:07:17+08:00","url":"https://cuitpanfei.github.io/me/posts/post-305/","headline":"\nSentinel--服务容错","description":"微服务\n高并发带来的问题 在微服务架构中，我们将业务拆分成一个个的服务，服务与服务之间可以相互调用，但是由于网络原因 或者自身的原因，服务并不能保证服务的100%可用，如果单个服务出现问题，调用这个服务就会出现 网络延迟，此时若有大量的网络涌入，会形成任务堆积，最终导致服务瘫痪。\n","inLanguage":"zh-CN","articleSection":"posts","wordCount":11013,"image":["https://img.maruifu.com/images/2021/01/29/2021-01-29-8.29.58.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.30.30.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.31.22.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.31.44.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.32.12.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.33.48.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.35.47.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.37.36.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.38.07.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.39.43.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-8.40.48.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.02.08.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.03.02.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.03.30.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.03.59.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.06.14.png","https://img.maruifu.com/images/2022/02/17/image-20220217152248149.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.10.45.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.11.05.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.12.17.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.13.31.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.13.48.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.14.06.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.19.22.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.20.48.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.22.30.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.22.58.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.25.02.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.26.01.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.26.34.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.27.10.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.28.28.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.42.57.png","https://img.maruifu.com/images/2021/01/29/2021-01-29-9.53.43.png"],"author":{"@type":"Person","description":"Viva La Vida","email":"1730789103@qq.com","image":"https://cuitpanfei.github.io/icons/apple-touch-icon.png","url":"https://cuitpanfei.github.io/me/","name":"cuitpanfei"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)","publisher":{"@type":"Organization","name":"CUITPF","logo":{"@type":"ImageObject","url":"https://cuitpanfei.github.io/icons/apple-touch-icon.png"},"url":"https://cuitpanfei.github.io/me/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://cuitpanfei.github.io/me/"}}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@yixiuer"><meta property="og:title" content="
Sentinel--服务容错"><meta property="og:description" content="微服务
高并发带来的问题 在微服务架构中，我们将业务拆分成一个个的服务，服务与服务之间可以相互调用，但是由于网络原因 或者自身的原因，服务并不能保证服务的100%可用，如果单个服务出现问题，调用这个服务就会出现 网络延迟，此时若有大量的网络涌入，会形成任务堆积，最终导致服务瘫痪。
"><meta property="og:url" content="https://cuitpanfei.github.io/me/posts/post-305/"><meta property="og:site_name" content="CUITPF"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://img.maruifu.com/images/2021/01/29/2021-01-29-8.29.58.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-01-29T13:57:00+00:00"><meta property="article:modified_time" content="2025-09-14T03:07:17+08:00"><meta property="article:section" content="posts"></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/me/ class=brand>CUITPF</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/me/posts/><svg viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7.0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6.0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6.0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3.0 64v48c0 8.8 7.2 16 16 16h480c8.8.0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class=menu-item-name>文章</span></a></li><li class=menu-item><a href=/me/categories/><svg viewBox="0 0 512 512" class="icon th"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255.0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255.0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255.0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255.0-24 10.745-24 24zm386.667-56H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24z"/></svg><span class=menu-item-name>分类</span></a></li><li class=menu-item><a href=/me/tags/><svg viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a48 48 0 0014.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM112 160c-26.51.0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882.0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397.0h48.721a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882z"/></svg><span class=menu-item-name>标签</span></a></li><li class=menu-item><a href=/me/about/><svg viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6.0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7.0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4.0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9s28-2.7 40.9-6.9c2.3-.7 4.7-1.1 7.1-1.1 42.9.0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class=menu-item-name>关于</span></a></li><li class=menu-item><button id=theme-switcher type=button aria-label=切换主题><svg viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg><svg viewBox="0 0 576 512" class="icon theme-icon-system"><path d="M528 0H48C21.5.0.0 21.5.0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3.0-24 10.7-24 24s10.7 24 24 24h272c13.3.0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5.0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"/></svg></button></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label><label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=justify data-type=posts data-toc-num=true><h1 class="post-title p-name">Sentinel--服务容错</h1><div class=post-meta><time datetime=2021-01-29T13:57:00+00:00 class="post-meta-item published dt-published"><svg viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2021.1.29</time>
<time datetime=2025-09-14T03:07:17+08:00 class="post-meta-item modified dt-updated"><svg viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M4e2 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 4e2H54a6 6 0 01-6-6V160h352v298a6 6 0 01-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2025.9.14</time>
<span class="post-meta-item category"><svg viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/me/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class="category-link p-category">架构设计</a></span>
<span class="post-meta-item wordcount"><svg viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;11013</span>
<span class="post-meta-item reading-time"><svg viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;22&nbsp;分钟</span></div><div class="post-body e-content"><p><a href=/tag/%E5%BE%AE%E6%9C%8D%E5%8A%A1>微服务</a></p><h2 id=高并发带来的问题><a href=#高并发带来的问题 class=anchor-link aria-label=高并发带来的问题><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>高并发带来的问题</h2><p>在微服务架构中，我们将业务拆分成一个个的服务，服务与服务之间可以相互调用，但是由于网络原因 或者自身的原因，服务并不能保证服务的100%可用，如果单个服务出现问题，调用这个服务就会出现 网络延迟，此时若有大量的网络涌入，会形成任务堆积，最终导致服务瘫痪。</p><p><strong>接下来，我们来模拟一个高并发的场景</strong></p><ol><li>编写java代码</li></ol><pre tabindex=0><code>@RestController
@Slf4j
public class OrderController2 {
    @Autowired
    private OrderService orderService;
    @Autowired
    private ProductService productService;

    @RequestMapping(&#34;/order/prod/{pid}&#34;)
    public Order order(@PathVariable(&#34;pid&#34;) Integer pid) {
        log.info(&#34;接收到{}号商品的下单请求,接下来调用商品微服务查询此商品信息&#34;, pid);//调用商品微服 务,查询商品信息
        Product product = productService.findByPid(pid);
        log.info(&#34;查询到{}号商品的信息,内容是:{}&#34;, pid, JSON.toJSONString(product)); //模拟一次网络延时
        try {
            Thread.sleep(100);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        //下单(创建订单)
        Order order = new Order();
        order.setUid(1);
        order.setUsername(&#34;测试用户&#34;);
        order.setPid(pid);
        order.setPname(product.getPname());
        order.setPprice(product.getPprice());
        order.setNumber(1);
        //为了不产生太多垃圾数据,暂时不做订单保存
        //orderService.createOrder(order);
        log.info(&#34;创建订单成功,订单信息为{}&#34;, JSON.toJSONString(order));
        return order;
    }

    @RequestMapping(&#34;/order/message&#34;)
    public String message() {
        return &#34;高并发下的问题测试&#34;;
    }
}
 
</code></pre><ol start=2><li>修改配置文件中tomcat的并发数</li></ol><pre tabindex=0><code>server:
 #端口
 port: 8091
 #tomcat配置
 tomcat:
  #tomcat的最大并发值修改为10,默认是200
 	max-threads: 10 #tomcat的最大并发值修改为10,默认是200
</code></pre><ol start=3><li>接下来使用压测工具,对请求进行压力测试</li></ol><p>下载地址https://jmeter.apache.org/</p><p>第一步:修改配置，并启动软件</p><p>进入bin目录,修改jmeter.properties文件中的语言支持为language=zh_CN，然后点击jmeter.bat 启动 软件。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.29.58.png alt=压测工具><span class=caption>※ 压测工具</span></p><p>第二步:添加线程组</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.30.30.png alt=添加线程组><span class=caption>※ 添加线程组</span></p><p>第三步:配置线程并发数</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.31.22.png alt=配置线程并发数><span class=caption>※ 配置线程并发数</span></p><p>第四步:添加Http取样</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.31.44.png alt=添加Http取样><span class=caption>※ 添加Http取样</span></p><p>第五步:配置取样，并启动测试</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.32.12.png alt=配置取样，并启动测试><span class=caption>※ 配置取样，并启动测试</span></p><ol start=4><li>访问message方法观察效果</li></ol><p><strong>结论</strong>: 此时会发现, 由于order方法囤积了大量请求, 导致message方法的访问出现了问题，这就是服务雪崩的 雏形。</p><h2 id=服务雪崩效应><a href=#服务雪崩效应 class=anchor-link aria-label=服务雪崩效应><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>服务雪崩效应</h2><p>在分布式系统中,由于网络原因或自身的原因,服务一般无法保证 100% 可用。如果一个服务出现了问 题，调用这个服务就会出现线程阻塞的情况，此时若有大量的请求涌入，就会出现多条线程阻塞等待， 进而导致服务瘫痪。</p><p>由于服务与服务之间的依赖性，故障会传播，会对整个微服务系统造成灾难性的严重后果，这就是服务 故障的 <strong>雪崩效应</strong> 。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.33.48.png alt=服务雪崩效应><span class=caption>※ 服务雪崩效应</span></p><p>雪崩发生的原因多种多样，有不合理的容量设计，或者是高并发下某一个方法响应变慢，亦或是某台机 器的资源耗尽。我们无法完全杜绝雪崩源头的发生，只有做好足够的容错，保证在一个服务发生问题， 不会影响到其它服务的正常运行。也就是"雪落而不雪崩"。</p><h2 id=常见容错方案><a href=#常见容错方案 class=anchor-link aria-label=常见容错方案><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>常见容错方案</h2><p>要防止雪崩的扩散，我们就要做好服务的容错，容错说白了就是保护自己不被猪队友拖垮的一些措施,</p><p>下面介绍常见的服务容错思路和组件。</p><p><strong>常见的容错思路</strong></p><p>常见的容错思路有隔离、超时、限流、熔断、降级这几种，下面分别介绍一下。</p><ul><li><strong>隔离</strong></li></ul><p>它是指将系统按照一定的原则划分为若干个服务模块，各个模块之间相对独立，无强依赖。当有故障发 生时，能将问题和影响隔离在某个模块内部，而不扩散风险，不波及其它模块，不影响整体的系统服 务。常见的隔离方式有:线程池隔离和信号量隔离.</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.35.47.png alt=隔离><span class=caption>※ 隔离</span></p><ul><li><strong>超时</strong></li></ul><p>在上游服务调用下游服务的时候，设置一个最大响应时间，如果超过这个时间，下游未作出反应，就断 开请求，释放掉线程。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.37.36.png alt=超时><span class=caption>※ 超时</span></p><ul><li><strong>限流</strong></li></ul><p>限流就是限制系统的输入和输出流量已达到保护系统的目的。为了保证系统的稳固运行,一旦达到的需要 限制的阈值,就需要限制流量并采取少量措施以完成限制流量的目的。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.38.07.png alt=限流><span class=caption>※ 限流</span></p><ul><li><strong>熔断</strong></li></ul><p>在互联网系统中，当下游服务因访问压力过大而响应变慢或失败，上游服务为了保护系统整体的可 用性，可以暂时切断对下游服务的调用。这种牺牲局部，保全整体的措施就叫做熔断。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.39.43.png alt=熔断**><span class=caption>※ 熔断**</span></p><p><strong>服务熔断一般有三种状态:</strong></p><ul><li>熔断关闭状态(Closed)</li></ul><p>服务没有故障时，熔断器所处的状态，对调用方的调用不做任何限制</p><ul><li>熔断开启状态(Open)</li></ul><p>后续对该服务接口的调用不再经过网络，直接执行本地的fallback方法</p><ul><li>半熔断状态(Half-Open)</li></ul><p>尝试恢复服务调用，允许有限的流量调用该服务，并监控调用成功率。如果成功率达到预期，则说明服务已恢复，进入熔断关闭状态;如果成功率仍旧很低，则重新进入熔断关闭状态。</p><ul><li><strong>降级</strong></li></ul><p>降级其实就是为服务提供一个托底方案，一旦服务无法正常调用，就使用托底方案。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.40.48.png alt=降级><span class=caption>※ 降级</span></p><p>常见的容错组件</p><ul><li><p>Hystrix</p><p>Hystrix是由Netflflix开源的一个延迟和容错库，用于隔离访问远程系统、服务或者第三方库，防止级联 失败，从而提升系统的可用性与容错性。</p></li><li><p>Resilience4J Resilicence4J一款非常轻量、简单，并且文档非常清晰、丰富的熔断工具，这也是Hystrix官方推荐的替 代产品。不仅如此，Resilicence4j还原生支持Spring Boot 1.x/2.x，而且监控也支持和prometheus等 多款主流产品进行整合。</p></li><li><p>Sentinel Sentinel 是阿里巴巴开源的一款断路器实现，本身在阿里内部已经被大规模采用，非常稳定。</p></li></ul><p><strong>下面是三个组件在各方面的对比:</strong></p><div class=table-container><table><thead><tr><th></th><th>Sentinel</th><th>Hystrix</th><th>resilience4j</th></tr></thead><tbody><tr><td>隔离策略</td><td>信号量隔离(并发线程数限流)</td><td>线程池隔离/信号量隔离</td><td>信号量隔离</td></tr><tr><td>熔断降级策略</td><td>基于响应时间、异常比率、异常数</td><td>基于异常比率</td><td>基于异常比率、响应</td></tr><tr><td>实时统计实现</td><td>滑动窗口(LeapArray)</td><td>滑动窗口(基 于 RxJava)</td><td>Ring Bit Buffer</td></tr><tr><td>动态规则配置</td><td>支持多种数据源</td><td>支持多种数据</td><td>有限支持</td></tr><tr><td>扩展性</td><td>多个扩展点</td><td>插件的形式</td><td>接口的形式</td></tr><tr><td>基于注解的支 持</td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td>限流</td><td>基于 QPS，支持基于调用关系的限流</td><td>有限的支持</td><td>Rate Limiter</td></tr><tr><td>流量整形</td><td>支持预热模式、匀速器模式、预热排队模式</td><td>不支持</td><td>简单的 Rate Limiter模式</td></tr><tr><td>系统自适应保护</td><td>支持</td><td>不支持</td><td>不支持</td></tr><tr><td>控制台</td><td>提供开箱即用的控制台，可配置规则、查看秒级监控、机器发现等</td><td>简单的监控查看</td><td>不提供控制台，可对接其它监控系统</td></tr></tbody></table></div><h2 id=sentinel入门><a href=#sentinel入门 class=anchor-link aria-label=sentinel入门><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Sentinel入门</h2><h3 id=什么是sentine><a href=#什么是sentine class=anchor-link aria-label=什么是sentine><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>什么是Sentine</h3><p>Sentinel (分布式系统的流量防卫兵) 是阿里开源的一套用于<strong>服务容错</strong>的综合性解决方案。它以流量 为切入点, 从<strong>流量控制、熔断降级、系统负载保护</strong>等多个维度来保护服务的稳定性。</p><p><strong>Sentinel</strong> <strong>具有以下特征</strong></p><ul><li><p><strong>丰富的应用场景</strong>:Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景, 例如秒杀(即 突发流量控制在系统容量可以承受的范围)、消息削峰填谷、集群流量控制、实时熔断下游不可用 应用等。</p></li><li><p><strong>完备的实时监控</strong>:Sentinel 提供了实时的监控功能。通过控制台可以看到接入应用的单台机器秒 级数据, 甚至 500 台以下规模的集群的汇总运行情况。</p></li><li><p><strong>广泛的开源生态</strong>:Sentinel 提供开箱即用的与其它开源框架/库的整合模块, 例如与 SpringCloud、 Dubbo、gRPC 的整合。只需要引入相应的依赖并进行简单的配置即可快速地接入Sentinel。</p></li><li><p><strong>完善的SPI扩展点</strong>:Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快 速地定制逻辑。例如定制规则管理、适配动态数据源等。</p></li></ul><p><strong>Sentinel分为两个部分</strong>:</p><ul><li>核心库(Java 客户端)不依赖任何框架/库,能够运行于所有 Java 运行时环境，同时对 Dubbo/Spring Cloud 等框架也有较好的支持。</li><li>控制台(Dashboard)基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等 应用容器。</li></ul><h3 id=微服务集成sentinel><a href=#微服务集成sentinel class=anchor-link aria-label=微服务集成sentinel><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>微服务集成Sentinel</h3><p>为微服务集成Sentinel非常简单, 只需要加入Sentinel的依赖即可</p><p>1 在pom.xml中加入下面依赖</p><pre tabindex=0><code>&lt;dependency&gt;
	&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; 
	&lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; 
&lt;/dependency&gt;
</code></pre><p>2 编写一个Controller测试使用</p><pre tabindex=0><code>package cn.maruifu.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

//
@RestController
@Slf4j
public class OrderTestController {

    @RequestMapping(&#34;/order/message1&#34;)
    public String message1() {
        return &#34;message1&#34;;
    }

    @RequestMapping(&#34;/order/message2&#34;)
    public String message2() {
        return &#34;message2&#34;;
    }
}
</code></pre><h3 id=安装sentinel控制台><a href=#安装sentinel控制台 class=anchor-link aria-label=安装sentinel控制台><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>安装Sentinel控制台</h3><p>Sentinel 提供一个轻量级的控制台, 它提供机器发现、单机资源实时监控以及规则管理等功能。</p><ol><li>下载jar包,解压到文件夹 <a href=https://github.com/alibaba/Sentinel/releases target=_blank rel=noopener>https://github.com/alibaba/Sentinel/releases</a></li></ol><p>2 .启动控制台</p><pre tabindex=0><code> # 直接使用jar命令启动项目(控制台本身是一个SpringBoot项目)
java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.3.jar
</code></pre><ol start=3><li>修改 shop-order ,在里面加入有关控制台的配置</li></ol><pre tabindex=0><code>spring:
  cloud:
    sentinel:
      transport:
        port: 9999 #跟控制台交流的端口,随意指定一个未使用的端口即可 
        dashboard: localhost:8080 # 指定控制台服务的地址
</code></pre><ol start=4><li>通过浏览器访问localhost:8080 进入控制台 ( 默认用户名密码是 sentinel/sentinel )</li><li><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.02.08.png alt=控制台><span class=caption>※ 控制台</span></li></ol><blockquote><p>控制台的使用原理Sentinel的控制台其实就是一个SpringBoot编写的程序。我们需要将我们的微服务程序注册到控制台上, 即在微服务中指定控制台的地址, 并且还要开启一个跟控制台传递数据的端口, 控制台也可以通过此端口 调用微服务中的监控程序获取微服务的各种信息。</p></blockquote><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.03.02.png alt=控制台><span class=caption>※ 控制台</span></p><h3 id=实现一个接口的限流><a href=#实现一个接口的限流 class=anchor-link aria-label=实现一个接口的限流><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>实现一个接口的限流</h3><p>通过控制台为message1添加一个流控规则</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.03.30.png alt=流控规则><span class=caption>※ 流控规则</span></p><p>通过控制台快速频繁访问, 观察效果</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.03.59.png alt=控制台快速频繁访问><span class=caption>※ 控制台快速频繁访问</span></p><h2 id=sentinel的概念和功能><a href=#sentinel的概念和功能 class=anchor-link aria-label=sentinel的概念和功能><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Sentinel的概念和功能</h2><h3 id=基本概念><a href=#基本概念 class=anchor-link aria-label=基本概念><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>基本概念</h3><ul><li><strong>资源</strong></li></ul><p><strong>资源就是Sentinel要保护的东西</strong></p><p>资源是 Sentinel 的关键概念。它可以是 Java 应用程序中的任何内容，可以是一个服务，也可以是一个 方法，甚至可以是一段代码。</p><blockquote><p>我们入门案例中的message1方法就可以认为是一个资源</p></blockquote><ul><li><strong>规则</strong></li></ul><p><strong>规则就是用来定义如何进行保护资源的</strong></p><p>作用在资源之上, 定义以什么样的方式保护资源，主要包括流量控制规则、熔断降级规则以及系统保护 规则。</p><blockquote><p>我们入门案例中就是为message1资源设置了一种流控规则, 限制了进入message1的流量</p></blockquote><h3 id=重要功能><a href=#重要功能 class=anchor-link aria-label=重要功能><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>重要功能</h3><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.06.14.png alt=重要功能><span class=caption>※ 重要功能</span></p><p>Sentinel的主要功能就是容错，主要体现为下面这三个:</p><ul><li><strong>流量控制</strong></li></ul><p>流量控制在网络传输中是一个常用的概念，它用于调整网络包的数据。任意时间到来的请求往往是随机 不可控的，而系统的处理能力是有限的。我们需要根据系统的处理能力对流量进行控制。Sentinel 作为 一个调配器，可以根据需要把随机的请求调整成合适的形状。</p><ul><li><strong>熔断降级</strong></li></ul><p>当检测到调用链路中某个资源出现不稳定的表现，例如请求响应时间长或异常比例升高的时候，则对这 个资源的调用进行限制，让请求快速失败，避免影响到其它的资源而导致级联故障</p><p><strong>Sentinel 对这个问题采取了两种手段:</strong></p><ul><li>通过并发线程数进行限制</li></ul><p>Sentinel 通过限制资源并发线程的数量，来减少不稳定资源对其它资源的影响。当某个资源出现不稳定 的情况下，例如响应时间变长，对资源的直接影响就是会造成线程数的逐步堆积。当线程数在特定资源 上堆积到一定的数量之后，对该资源的新请求就会被拒绝。堆积的线程完成任务后才开始继续接收请 求。</p><ul><li>通过响应时间对资源进行降级</li></ul><p>除了对并发线程数进行控制以外，Sentinel 还可以通过响应时间来快速降级不稳定的资源。当依赖的资 源出现响应时间过长后，所有对该资源的访问都会被直接拒绝，直到过了指定的时间窗口之后才重新恢复。</p><p><strong>Sentinel和 Hystrix的区别</strong></p><blockquote><p>两者的原则是一致的, 都是当一个资源出现问题时, 让其快速失败, 不要波及到其它服务 但是在限制的手段上, 确采取了完全不一样的方法:</p><p>Hystrix 采用的是线程池隔离的方式, 优点是做到了资源之间的隔离, 缺点是增加了线程切换 的成本。</p><p>Sentinel 采用的是通过并发线程的数量和响应时间来对资源做限制。</p></blockquote><ul><li>系统负载保护 Sentinel 同时提供系统维度的自适应保护能力。当系统负载较高的时候，如果还持续让请求进入 可能会导致系统崩溃，无法响应。在集群环境下，会把本应这台机器承载的流量转发到其它的机器 上去。如果这个时候其它的机器也处在一个边缘状态的时候，Sentinel 提供了对应的保护机制， 让系统的入口流量和系统的负载达到一个平衡，保证系统在能力范围之内处理最多的请求</li></ul><p><strong>总之一句话:我们需要做的事情，就是在Sentinel的资源上配置各种各样的规则，来实现各种容错的功能。</strong></p><h2 id=sentinel规则><a href=#sentinel规则 class=anchor-link aria-label=sentinel规则><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Sentinel规则</h2><p>流量控制，其原理是监控应用流量的QPS(每秒查询率) 或并发线程数等指标，当达到指定的阈值时对流 量进行控制，以避免被瞬时的流量高峰冲垮，从而保障应用的高可用性。</p><p>第1步: 点击簇点链路，我们就可以看到访问过的接口地址，然后点击对应的流控按钮，进入流控规则配 置页面。新增流控规则界面如下</p><h3 id=流控规则><a href=#流控规则 class=anchor-link aria-label=流控规则><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>流控规则</h3><p><img src=https://img.maruifu.com/images/2022/02/17/image-20220217152248149.png alt=image-20220217152248149><span class=caption>※ image-20220217152248149</span></p><p><strong>资源名</strong>:唯一名称，默认是请求路径，可自定义</p><p><strong>针对来源</strong>:指定对哪个微服务进行限流，默认指default，意思是不区分来源，全部限制</p><p><strong>阈值类型单机阈值</strong>:</p><ul><li><p>QPS(每秒请求数量): 当调用该接口的QPS达到阈值的时候，进行限流</p></li><li><p>线程数:当调用该接口的线程数达到阈值的时候，进行限流</p></li></ul><p><strong>是否集群</strong>:暂不需要集群 接下来我们以QPS为例来研究限流规则的配置。</p><h4 id=简单配置><a href=#简单配置 class=anchor-link aria-label=简单配置><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>简单配置</h4><p>我们先做一个简单配置，设置阈值类型为QPS，单机阈值为3。即每秒请求量大于3的时候开始限流。接下来，在流控规则页面就可以看到这个配置。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.10.45.png alt=简单配置><span class=caption>※ 简单配置</span></p><h4 id=配置流控模式><a href=#配置流控模式 class=anchor-link aria-label=配置流控模式><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>配置流控模式</h4><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.11.05.png alt=配置流控模式><span class=caption>※ 配置流控模式</span></p><p><strong>sentinel共有三种流控模式，分别是:</strong></p><ul><li><p>直接(默认):接口达到限流条件时，开启限流</p></li><li><p>关联:当关联的资源达到限流条件时，开启限流 [适合做应用让步]</p></li><li><p>链路:当从某个接口过来的资源达到限流条件时，开启限流</p></li></ul><p>下面呢分别演示三种模式:</p><p><strong>直接流控模式</strong></p><p>直接流控模式是最简单的模式，当指定的接口达到限流条件时开启限流。上面案例使用的就是直接流控 模式。</p><p><strong>关联流控模式</strong></p><p>关联流控模式指的是，当指定接口关联的接口达到限流条件时，开启对指定接口开启限流。第1步:配 置限流规则,将流控模式设置为关联，关联资源设置为的 /order/message2。</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.12.17.png alt=关联流控模式><span class=caption>※ 关联流控模式</span></p><p>通过Jmeter软件向/order/message2连续发送请求，注意QPS一定要大于3</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.13.31.png alt="截屏2021-01-29 下午9.13.31"><span class=caption>※ 截屏2021-01-29 下午9.13.31</span></p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.13.48.png alt="截屏2021-01-29 下午9.13.48"><span class=caption>※ 截屏2021-01-29 下午9.13.48</span></p><p>访问/order/message1,会发现已经被限流</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.14.06.png alt="截屏2021-01-29 下午9.14.06"><span class=caption>※ 截屏2021-01-29 下午9.14.06</span></p><p><strong>链路流控模式</strong></p><p>链路流控模式指的是，当从某个接口过来的资源达到限流条件时，开启限流。它的功能有点类似于针对 来源配置项，区别在于:<strong>针对来源是针对上级微服务，而链路流控是针对上级接口，也就是说它的粒度 更细。</strong></p><p>1.编写一个service，在里面添加一个方法message</p><pre tabindex=0><code>
package cn.maruifu.service.impl;


import com.alibaba.csp.sentinel.annotation.SentinelResource;
import org.springframework.stereotype.Service;

@Service
public class OrderTestServiceImpl {
    @SentinelResource(&#34;message&#34;)
    public void message() {
        System.out.println(&#34;message&#34;);
    }
}
</code></pre><p>第2步: 在Controller中声明两个方法，分别调用service中的方法message</p><pre tabindex=0><code>package cn.maruifu.controller;

import cn.maruifu.service.impl.OrderTestServiceImpl;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

//
@RestController
@Slf4j
public class OrderTestController {

    /*

    @RequestMapping(&#34;/order/message1&#34;)
    public String message1() {
        return &#34;message1&#34;;
    }

    @RequestMapping(&#34;/order/message2&#34;)
    public String message2() {
        return &#34;message2&#34;;
    }*/



    @Autowired
    private OrderTestServiceImpl orderTestServiceImpl;

    @RequestMapping(&#34;/order/message1&#34;)
    public String message1() {
        orderTestServiceImpl.message();
        return &#34;message1&#34;;
    }
    @RequestMapping(&#34;/order/message2&#34;)
    public String message2() {
        orderTestServiceImpl.message();
        return &#34;message2&#34;;
    } 
}
</code></pre><p>第3步: 禁止收敛URL的入口 context</p><blockquote><p>1.6.3 版本开始，Sentinel Web fifilter默认收敛所有URL的入口context，因此链路限流不生效。 1.7.0 版本开始(对应SCA的2.1.1.RELEASE)，官方在CommonFilter 引入了WEB_CONTEXT_UNIFY 参数， 用于控制是否收敛context。将其配置为 false 即可根据不同的URL进行链路限流。</p><p>SCA 2.1.1.RELEASE之后的版本,可以通过配置spring.cloud.sentinel.web-context-unify=false即 可关闭收敛我们当前使用的版本是SpringCloud Alibaba 2.1.0.RELEASE，无法实现链路限流。</p><p>目前官方还未发布SCA 2.1.2.RELEASE，所以我们只能使用2.1.1.RELEASE，需要写代码的形式实 现</p></blockquote><p><strong>(1)</strong> 暂时将SpringCloud Alibaba的版本调整为2.1.1.RELEASE</p><pre tabindex=0><code>&lt;spring-cloud-alibaba.version&gt;2.1.1.RELEASE&lt;/spring-cloud-alibaba.version&gt;
</code></pre><p><strong>(2)</strong> 配置文件中关闭sentinel的CommonFilter实例化</p><pre tabindex=0><code>
spring:
  cloud:
    sentinel:
      filter:
       enabled: false
</code></pre><p><strong>(3)</strong> 添加一个配置类，自己构建CommonFilter实例</p><pre tabindex=0><code>package cn.maruifu.config;
import com.alibaba.csp.sentinel.adapter.servlet.CommonFilter;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration; @Configuration
public class FilterContextConfig {
    @Bean
    public FilterRegistrationBean sentinelFilterRegistration() {
        FilterRegistrationBean registration = new FilterRegistrationBean();
        registration.setFilter(new CommonFilter());
        registration.addUrlPatterns(&#34;/*&#34;);
         // 入口资源关闭聚合
        registration.addInitParameter(CommonFilter.WEB_CONTEXT_UNIFY, &#34;false&#34;);
        registration.setName(&#34;sentinelFilter&#34;);
        registration.setOrder(1);
        return registration;
    }
}

 
</code></pre><p><strong>(4)</strong> : 控制台配置限流规则</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.19.22.png alt=控制台配置限流规则><span class=caption>※ 控制台配置限流规则</span></p><p><strong>(5)</strong> :分别通过 /order/message1 和 /order/message2 访问, 发现2没问题, 1的被限流了</p><h4 id=配置流控效果><a href=#配置流控效果 class=anchor-link aria-label=配置流控效果><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>配置流控效果</h4><ul><li><p><strong>快速失败(默认)</strong>: 直接失败，抛出异常，不做任何额外的处理，是最简单的效果</p></li><li><p><strong>Warm Up</strong>:它从开始阈值到最大QPS阈值会有一个缓冲阶段，一开始的阈值是最大QPS阈值的 1/3，然后慢慢增长，直到最大阈值，适用于将突然增大的流量转换为缓步增长的场景。</p></li><li><p><strong>排队等待</strong>:让请求以均匀的速度通过，单机阈值为每秒通过数量，其余的排队等待; 它还会让设 置一个超时时间，当请求超过超时间时间还未处理，则会被丢弃</p></li></ul><h3 id=降级规则><a href=#降级规则 class=anchor-link aria-label=降级规则><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>降级规则</h3><p><strong>降级规则就是设置当满足什么条件的时候，对服务进行降级。<strong><strong>Sentinel</strong></strong>提供了三个衡量条件:</strong></p><ul><li>平均响应时间 :当资源的平均响应时间超过阈值(以 ms 为单位)之后，资源进入准降级状态。 如果接下来 1s 内持续进入 5 个请求，它们的 RT都持续超过这个阈值，那么在接下的时间窗口 (以 s 为单位)之内，就会对这个方法进行服务降级。</li><li><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.20.48.png alt=平均响应时间><span class=caption>※ 平均响应时间</span></li></ul><blockquote><p>注意 Sentinel 默认统计的 RT 上限是 4900 ms，超出此阈值的都会算作 4900 ms，若需要变更此 上限可以通过启动配置项 -Dcsp.sentinel.statistic.max.rt=xxx 来配置。</p></blockquote><ul><li>异常比例:当资源的每秒异常总数占通过量的比值超过阈值之后，资源进入降级状态，即在接下的 时间窗口(以 s 为单位)之内，对这个方法的调用都会自动地返回。异常比率的阈值范围是 [0.0,1.0]。</li></ul><p>第1步: 首先模拟一个异常</p><pre tabindex=0><code>int i=0;

@RequestMapping(&#34;/order/message2&#34;) 
public String message2(){
    i++;
    //异常比例为0.333
    if(i%3==0){
        throw new RuntimeException();
    }
    return&#34;message2&#34;;
}
</code></pre><p>第2步: 设置异常比例为0.25</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.22.30.png alt=置异常比例为0.25><span class=caption>※ 置异常比例为0.25</span></p><ul><li>异常数 :当资源近 1 分钟的异常数目超过阈值之后会进行服务降级。注意由于统计时间窗口是分 钟级别的，若时间窗口小于 60s，则结束熔断状态后仍可能再进入熔断状态。</li></ul><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.22.58.png alt="截屏2021-01-29 下午9.22.58"><span class=caption>※ 截屏2021-01-29 下午9.22.58</span></p><blockquote><p>问题:流控规则和降级规则返回的异常页面是一样的，我们怎么来区分到底是什么原因导致的 呢?</p></blockquote><h3 id=热点规则><a href=#热点规则 class=anchor-link aria-label=热点规则><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>热点规则</h3><p>热点参数流控规则是一种更细粒度的流控规则, 它允许将规则具体到参数上。 <strong>热点规则简单使用</strong></p><p>第1步: 编写代码</p><pre tabindex=0><code>@RequestMapping(&#34;/order/message3&#34;) 
@SentinelResource(&#34;message3&#34;)
//注意这里必须使用这个注解标识,热点规则不生效 
public String message3(String name, Integer age) {
    return name + age;
}
</code></pre><p>第2步: 配置热点规则 <img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.25.02.png alt="热点规则 "><span class=caption>※ 热点规则</span></p><p>第3步: 分别用两个参数访问,会发现只对第一个参数限流了</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.26.01.png alt="截屏2021-01-29 下午9.26.01"><span class=caption>※ 截屏2021-01-29 下午9.26.01</span></p><p><strong>热点规则增强使用</strong></p><p>参数例外项允许对一个参数的具体值进行流控</p><p>编辑刚才定义的规则,增加参数例外项</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.26.34.png alt=热点规则增强使用><span class=caption>※ 热点规则增强使用</span></p><h3 id=授权规则><a href=#授权规则 class=anchor-link aria-label=授权规则><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>授权规则</h3><p>很多时候，我们需要根据调用来源来判断该次请求是否允许放行，这时候可以使用 Sentinel 的来源访问控制的功能。来源访问控制根据资源的请求来源(origin)限制资源是否通过:</p><ul><li><p>若配置白名单，则只有请求来源位于白名单内时才可通过;</p></li><li><p>若配置黑名单，则请求来源位于黑名单时不通过，其余的请求通过。</p></li><li><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.27.10.png alt="截屏2021-01-29 下午9.27.10"><span class=caption>※ 截屏2021-01-29 下午9.27.10</span></p></li></ul><p><strong>上面的资源名和授权类型不难理解，但是流控应用怎么填写呢?</strong></p><blockquote><p>其实这个位置要填写的是来源标识，Sentinel提供了 RequestOriginParser 接口来处理来源。</p><p>只要Sentinel保护的接口资源被访问，Sentinel就会调用 RequestOriginParser 的实现类去解析访问来源。</p></blockquote><p>第1步: 自定义来源处理规则</p><pre tabindex=0><code>@Component
public class RequestOriginParserDefinition implements RequestOriginParser{ @Override
public String parseOrigin(HttpServletRequest request) {
    String serviceName = request.getParameter(&#34;serviceName&#34;);
    return serviceName;
}
}
</code></pre><p>第2步: 授权规则配置</p><p>这个配置的意思是只有serviceName=pc不能访问(黑名单)</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.28.28.png alt=授权规则配置><span class=caption>※ 授权规则配置</span></p><p>第3步: 访问 http://localhost:8091/order/message1?serviceName=pc观察结果</p><h3 id=系统规则><a href=#系统规则 class=anchor-link aria-label=系统规则><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>系统规则</h3><p>系统保护规则是从应用级别的入口流量进行控制，从单台机器的总体 Load、RT、入口 QPS 、CPU使用 率和线程数五个维度监控应用数据，让系统尽可能跑在最大吞吐量的同时保证系统整体的稳定性。系统 保护规则是应用整体维度的，而不是资源维度的，并且仅对入口流量 (进入应用的流量) 生效。</p><ul><li><p>Load(仅对 Linux/Unix-like 机器生效):当系统 load1 超过阈值，且系统当前的并发线程数超过 系统容量时才会触发系统保护。系统容量由系统的 maxQps * minRt 计算得出。设定参考值一般 是 CPU cores * 2.5。</p></li><li><p>RT:当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。</p></li><li><p>线程数:当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护。</p></li><li><p>入口 QPS:当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。</p></li><li><p>CPU使用率:当单台机器上所有入口流量的 CPU使用率达到阈值即触发系统保护</p></li></ul><p><strong>扩展:自定义异常返回</strong></p><pre tabindex=0><code>//异常处理页面
@Component
public class ExceptionHandlerPage implements UrlBlockHandler {
    //用于定义资源，并提供可选的异常处理和 fallback 配置项。其主要参数如下:
    @SentinelResource

    /**
     *  BlockException 异常接口,包含Sentinel的五个异常
     *  FlowException 限流异常
     *  DegradeException 降级异常
     *  ParamFlowException 参数限流异常
     *  AuthorityException 授权异常
     *  SystemBlockException 系统负载异常
     *
     */
    @Override
    public void blocked(HttpServletRequest request, HttpServletResponse
            response, BlockException e) throws IOException { response.setContentType(&#34;application/json;charset=utf-8&#34;);
        ResponseData data = null;
        if (e instanceof FlowException) {
            data = new ResponseData(-1, &#34;接口被限流了...&#34;);
        } else if (e instanceof DegradeException) {
            data = new ResponseData(-2, &#34;接口被降级了...&#34;);
        }
        response.getWriter().write(JSON.toJSONString(data));
    }
}
    @Data 
    //全参构造
    @AllArgsConstructor
    //无参构造
    @NoArgsConstructor
    class ResponseData {
        private int code;
        private String message;
    }
}
</code></pre><h2 id=sentinelresource的使用><a href=#sentinelresource的使用 class=anchor-link aria-label=sentinelresource的使用><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>@SentinelResource的使用</h2><p>在定义了资源点之后，我们可以通过Dashboard来设置限流和降级策略来对资源点进行保护。同时还能通过@SentinelResource来指定出现异常时的处理策略。</p><p>@SentinelResource 用于定义资源，并提供可选的异常处理和 fallback 配置项。其主要参数如下:</p><div class=table-container><table><thead><tr><th>属性</th><th>作用</th></tr></thead><tbody><tr><td>value</td><td>资源名称</td></tr><tr><td>entryType</td><td>entry类型，标记流量的方向，取值IN/OUT，默认是OUT</td></tr><tr><td>blockHandler</td><td>处理BlockException的函数名称,函数要求:1. 必须是 public2. 返回类型 参数与原方法一致3. 默认需和原方法在同一个类中。若希望使用其他类 的函数，可配置blockHandlerClass ，并指定blockHandlerClass里面的 方法。</td></tr><tr><td>blockHandlerClass</td><td>存放blockHandler的类,对应的处理函数必须static修饰。</td></tr><tr><td>fallback</td><td>用于在抛出异常的时候提供fallback处理逻辑。fallback函数可以针对所 有类型的异常(除了exceptionsToIgnore 里面排除掉的异常类型)进行 处理。函数要求:1. 返回类型与原方法一致2. 参数类型需要和原方法相 匹配3. 默认需和原方法在同一个类中。若希望使用其他类的函数，可配 置fallbackClass ，并指定fallbackClass里面的方法。</td></tr><tr><td>fallbackClass</td><td>存放fallback的类。对应的处理函数必须static修饰</td></tr><tr><td>defaultFallback</td><td>用于通用的 fallback 逻辑。默认fallback函数可以针对所有类型的异常进 行处理。若同时配置了 fallback 和 defaultFallback，以fallback为准。函 数要求:1. 返回类型与原方法一致2. 方法参数列表为空，或者有一个 Throwable 类型的参数。3. 默认需要和原方法在同一个类中。若希望使 用其他类的函数，可配置fallbackClass ，并指定 fallbackClass 里面的方 法。</td></tr><tr><td>exceptionsToIgnore</td><td>指定排除掉哪些异常。排除的异常不会计入异常统计，也不会进入 fallback逻辑，而是原样抛出</td></tr><tr><td>exceptionsToTrace</td><td>需要trace的异常</td></tr></tbody></table></div><p><strong>定义限流和降级后的处理方法</strong></p><p>方式一:直接将限流和降级方法定义在方法中</p><pre tabindex=0><code>@Service
@Slf4j
public class OrderServiceImpl3 {
    int i = 0;
    @SentinelResource(value = &#34;message&#34;,  /*指定发生BlockException时进入的方法*/
    blockHandler = &#34;blockHandler&#34;, /* 指定发生Throwable时进入的方法) */ 
    fallback = &#34;fallback&#34;
    public String message(){
        i++;
        if(i % 3 == 0){
          throw new RuntimeException();
        }
         return&#34;message&#34;;
     }
         
         
     //BlockException时进入的方法
     public String blockHandler(BlockException ex){
        log.error(&#34;{}&#34;, ex);
        return&#34;接口被限流或者降级了...&#34;;
    }

    //Throwable时进入的方法
    public String fallback(Throwable throwable) {
        log.error(&#34;{}&#34;, throwable);
        return &#34;接口发生异常了...&#34;;
    }
}
</code></pre><p>方式二: 将限流和降级方法外置到单独的类中</p><pre tabindex=0><code>@Service
@Slf4j
public class OrderServiceImpl3 {
   int i = 0;
   @SentinelResource(  value = &#34;message&#34;, blockHandlerClass = OrderServiceImpl3BlockHandlerClass.class, blockHandler = &#34;blockHandler&#34;, fallbackClass = OrderServiceImpl3FallbackClass.class, fallback = &#34;fallback&#34;  )
   public String message() {
       i++;
       if (i % 3 == 0) {
           throw new RuntimeException();
       }
       return &#34;message4&#34;;
   }
}
@Slf4j
public class OrderServiceImpl3BlockHandlerClass { //注意这里必须使用static修饰方法
   public static String blockHandler(BlockException ex) { 1 编写处理类
       log.error(&#34;{}&#34;, ex);
       return &#34;接口被限流或者降级了...&#34;;
   }
}
@Slf4j
public class OrderServiceImpl3FallbackClass { //注意这里必须使用static修饰方法
   public static String fallback(Throwable throwable) { log.error(&#34;{}&#34;, throwable);
       return &#34;接口发生异常了...&#34;;
   }
}
</code></pre><h2 id=sentinel规则持久化><a href=#sentinel规则持久化 class=anchor-link aria-label=sentinel规则持久化><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Sentinel规则持久化</h2><p>通过前面的讲解，我们已经知道，可以通过Dashboard来为每个Sentinel客户端设置各种各样的规则，</p><p>但是这里有一个问题，就是这些规则默认是存放在内存中，极不稳定，所以需要将其持久化。 本地文件数据源会定时轮询文件的变更，读取规则。这样我们既可以在应用本地直接修改文件来更新规则，也可以通过 Sentinel 控制台推送规则。以本地文件数据源为例，推送过程如下图所示:</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.42.57.png alt="截屏2021-01-29 下午9.42.57"><span class=caption>※ 截屏2021-01-29 下午9.42.57</span></p><p>首先 Sentinel 控制台通过 API 将规则推送至客户端并更新到内存中，接着注册的写数据源会将新的规则 保存到本地的文件中。</p><p>编写处理类</p><pre tabindex=0><code>package cn.maruifu.config;

import com.alibaba.csp.sentinel.command.handler.ModifyParamFlowRulesCommandHandler;
import com.alibaba.csp.sentinel.datasource.*;
import com.alibaba.csp.sentinel.init.InitFunc;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityRule;
import com.alibaba.csp.sentinel.slots.block.authority.AuthorityRuleManager;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeRule;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeRuleManager;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;
import com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowRuleManager;
import com.alibaba.csp.sentinel.slots.system.SystemRule;
import com.alibaba.csp.sentinel.slots.system.SystemRuleManager;
import com.alibaba.csp.sentinel.transport.util.WritableDataSourceRegistry;
import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.TypeReference;
import org.springframework.beans.factory.annotation.Value;

import java.io.File;
import java.io.IOException;
import java.util.List;

//规则持久化
public class FilePersistence implements InitFunc {
    @Value(&#34;spring.application:name&#34;)
    private String appcationName;

    @Override
    public void init() throws Exception {
        String ruleDir = System.getProperty(&#34;user.home&#34;) + &#34;/sentinel-rules/&#34; + appcationName;
        String flowRulePath = ruleDir + &#34;/flow-rule.json&#34;;
        String degradeRulePath = ruleDir + &#34;/degrade-rule.json&#34;;
        String systemRulePath = ruleDir + &#34;/system-rule.json&#34;;
        String authorityRulePath = ruleDir + &#34;/authority-rule.json&#34;;
        String paramFlowRulePath = ruleDir + &#34;/param-flow-rule.json&#34;;

        this.mkdirIfNotExits(ruleDir);
        this.createFileIfNotExits(flowRulePath);
        this.createFileIfNotExits(degradeRulePath);
        this.createFileIfNotExits(systemRulePath);
        this.createFileIfNotExits(authorityRulePath);
        this.createFileIfNotExits(paramFlowRulePath);
        // 流控规则
        ReadableDataSource&lt;String, List&lt;FlowRule&gt;&gt; flowRuleRDS = new FileRefreshableDataSource&lt;&gt;
        (flowRulePath, flowRuleListParser
        );
        FlowRuleManager.register2Property(flowRuleRDS.getProperty());
        WritableDataSource&lt;List&lt;FlowRule&gt;&gt; flowRuleWDS = new FileWritableDataSource&lt;&gt;(flowRulePath, this::encodeJson);
        WritableDataSourceRegistry.registerFlowDataSource(flowRuleWDS);
        // 降级规则
        ReadableDataSource&lt;String, List&lt;DegradeRule&gt;&gt; degradeRuleRDS = new FileRefreshableDataSource&lt;&gt;(degradeRulePath, degradeRuleListParser);
        DegradeRuleManager.register2Property(degradeRuleRDS.getProperty());
        WritableDataSource&lt;List&lt;DegradeRule&gt;&gt; degradeRuleWDS = new FileWritableDataSource&lt;&gt;(degradeRulePath, this::encodeJson);
        WritableDataSourceRegistry.registerDegradeDataSource(degradeRuleWDS);
        // 系统规则
        ReadableDataSource&lt;String, List&lt;SystemRule&gt;&gt; systemRuleRDS = new FileRefreshableDataSource&lt;&gt;(systemRulePath, systemRuleListParser);
        SystemRuleManager.register2Property(systemRuleRDS.getProperty());
        WritableDataSource&lt;List&lt;SystemRule&gt;&gt; systemRuleWDS = new FileWritableDataSource&lt;&gt;(systemRulePath, this::encodeJson);
        WritableDataSourceRegistry.registerSystemDataSource(systemRuleWDS);
        // 授权规则
        ReadableDataSource&lt;String, List&lt;AuthorityRule&gt;&gt; authorityRuleRDS = new FileRefreshableDataSource&lt;&gt;(authorityRulePath, authorityRuleListParser);
        AuthorityRuleManager.register2Property(authorityRuleRDS.getProperty());
        WritableDataSource&lt;List&lt;AuthorityRule&gt;&gt; authorityRuleWDS = new FileWritableDataSource&lt;&gt;(authorityRulePath, this::encodeJson);
        WritableDataSourceRegistry.registerAuthorityDataSource(authorityRuleWDS);
        // 热点参数规则
        ReadableDataSource&lt;String, List&lt;ParamFlowRule&gt;&gt; paramFlowRuleRDS = new FileRefreshableDataSource&lt;&gt;( paramFlowRulePath,paramFlowRuleListParser);
        ParamFlowRuleManager.register2Property(paramFlowRuleRDS.getProperty());
        WritableDataSource&lt;List&lt;ParamFlowRule&gt;&gt; paramFlowRuleWDS = new FileWritableDataSource&lt;&gt;( paramFlowRulePath, this::encodeJson );
        ModifyParamFlowRulesCommandHandler.setWritableDataSource(paramFlowRuleWDS);
    }

    private Converter&lt;String, List&lt;FlowRule&gt;&gt; flowRuleListParser = source -&gt; JSON.parseObject( source,  new TypeReference&lt;List&lt;FlowRule&gt;&gt;() { });

    private Converter&lt;String, List&lt;DegradeRule&gt;&gt; degradeRuleListParser = source -&gt; JSON.parseObject(  source, new TypeReference&lt;List&lt;DegradeRule&gt;&gt;() {  });

    private Converter&lt;String, List&lt;SystemRule&gt;&gt; systemRuleListParser = source -&gt; JSON.parseObject(source, new TypeReference&lt;List&lt;SystemRule&gt;&gt;() {});

    private Converter&lt;String, List&lt;AuthorityRule&gt;&gt; authorityRuleListParser = source -&gt; JSON.parseObject(source,new TypeReference&lt;List&lt;AuthorityRule&gt;&gt;() {} );

    private Converter&lt;String, List&lt;ParamFlowRule&gt;&gt; paramFlowRuleListParser = source -&gt; JSON.parseObject(source,new TypeReference&lt;List&lt;ParamFlowRule&gt;&gt;() { } );

    private void mkdirIfNotExits(String filePath) throws IOException {
        File file = new File(filePath);
        if (!file.exists()) {
            file.mkdirs();
        }
    }

    private void createFileIfNotExits(String filePath) throws IOException {
        File file = new File(filePath);
        if (!file.exists()) {
            file.createNewFile();
        }
    }

    private &lt;T&gt; String encodeJson(T t) {
        return JSON.toJSONString(t);
    }
}
</code></pre><p>添加配置 在resources下创建配置目录 META-INF/services ,然后添加文件<code>com.alibaba.csp.sentinel.init.InitFunc</code></p><p>在文件中添加配置类的全路径</p><pre tabindex=0><code>cn.maruifu.config.FilePersistence
</code></pre><h2 id=feign整合sentinel><a href=#feign整合sentinel class=anchor-link aria-label=feign整合sentinel><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>Feign整合Sentinel</h2><p>第1步: 引入sentinel的依赖</p><pre tabindex=0><code> 
&lt;!--sentinel客户端--&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; 
	&lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; 
&lt;/dependency&gt;
</code></pre><p>第2步: 在配置文件中开启Feign对Sentinel的支持</p><pre tabindex=0><code>feign:
	sentinel:
		enabled: true
</code></pre><p>第3步: 创建容错类</p><pre tabindex=0><code>//容错类要求必须实现被容错的接口,并为每个方法实现容错方案
package cn.maruifu.service.api;

import cn.maruifu.vo.Product;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

//容错类要求必须实现被容错的接口,并为每个方法实现容错方案
@Component
@Slf4j
public class ProductApiServiceFallBack implements ProductApiService {
    @Override
    public Product findByPid(Integer pid) {
        Product product = new Product();
        product.setPid(-1);
        return product;
    }
}
</code></pre><p>第4步: 为被容器的接口指定容错类</p><pre tabindex=0><code>package cn.maruifu.service.api;

import cn.maruifu.vo.Product;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
//value用于指定调用nacos下哪个微服务
//fallback用于指定容错类
@FeignClient(value = &#34;service-product&#34;, fallback = ProductApiServiceFallBack.class)
//声明调用的提供者的name
public interface ProductApiService {
    //指定调用提供者的哪个方法
//@FeignClient+@GetMapping 就是一个完整的请求路径 http://service- product/product/{pid}
    @GetMapping(value = &#34;/product/{pid}&#34;)
    Product findByPid(@PathVariable(&#34;pid&#34;) Integer pid);
}
</code></pre><p>第5步: 修改controller</p><pre tabindex=0><code>package cn.maruifu.controller;

import cn.maruifu.service.OrderService;
import cn.maruifu.service.api.ProductApiService;
import cn.maruifu.vo.Order;
import cn.maruifu.vo.Product;
import com.alibaba.fastjson.JSON;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cloud.client.ServiceInstance;
import org.springframework.cloud.client.discovery.DiscoveryClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import java.util.List;
import java.util.Random;

@RestController
@Slf4j
public class OrderController {
     @Autowired
    private RestTemplate restTemplate;
    @Autowired
    private OrderService orderService;

    @Autowired
    private DiscoveryClient discoveryClient;




    @Autowired
    private ProductApiService productApiService;

    //准备买1件商品
    @GetMapping(&#34;/order/prod/{pid}&#34;)
    public Order order(@PathVariable(&#34;pid&#34;) Integer pid) {
        log.info(&#34;&gt;&gt;客户下单，这时候要调用商品微服务查询商品信息&#34;);

        // 方法一 通过IP调用
        //通过restTemplate调用商品微服务
        //Product product = restTemplate.getForObject(&#34;http://localhost:8081/product/&#34; + pid, Product.class);

        // 方法二 从nacos中获取服务地址
        //ServiceInstance serviceInstance = discoveryClient.getInstances(&#34;service-product&#34;).get(0);
        //String url = serviceInstance.getHost() + &#34;:&#34; +serviceInstance.getPort();
        //log.info(&#34;&gt;&gt;从nacos中获取到的微服务地址为:&#34; + url);
        //Product product = restTemplate.getForObject(&#34;http://&#34; + url + &#34;/product/&#34; + pid, Product.class);

        // 方法三 从nacos中获取服务地址 自定义规则实现随机挑选服务
        //List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&#34;service-product&#34;);
        //int index = new Random().nextInt(instances.size());
        //ServiceInstance serviceInstance = instances.get(index);
        //String url = serviceInstance.getHost() + &#34;:&#34; + serviceInstance.getPort();
        //log.info(&#34;&gt;&gt;从nacos中获取到的微服务地址为:&#34; + url);
        //Product product = restTemplate.getForObject(&#34;http://&#34; + url + &#34;/product/&#34; + pid, Product.class);

        // 方法四  基于Ribbon实现负载均衡
        //直接使用微服务名字， 从nacos中获取服务地址
        //String url = &#34;service-product&#34;;
        //Product product = restTemplate.getForObject( &#34;http://&#34; + url + &#34;/product/&#34; + pid, Product.class);

        // 方法五 通过fegin调用商品微服务

        //  调用商品微服务,查询商品信息
        log.info(&#34;接收到{}号商品的下单请求,接下来调用商品微服务查询此商品信息&#34;, pid);

        Product product = productApiService.findByPid(pid);

        if (product.getPid() == -1) {
            Order order = new Order();
            order.setPname(&#34;下单失败&#34;);
            return order;
        }



        log.info(&#34;查询到{}号商品的信息,内容是:{}&#34;, pid, JSON.toJSONString(product)); //模拟一次网络延时
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        //下单(创建订单)
        Order order = new Order();
        order.setUid(1);
        order.setUsername(&#34;测试用户&#34;);
        order.setPid(product.getPid());
        order.setPname(product.getPname());
        order.setPprice(product.getPprice());
        order.setNumber(1);


        //为了不产生太多垃圾数据,暂时不做订单保存
        //orderService.save(order);
        log.info(&#34;创建订单成功,订单信息为{}&#34;, JSON.toJSONString(order));

        return order;
    }


    @RequestMapping(&#34;/order/message&#34;)
    public String message() {
        return &#34;高并发下的问题测试&#34;;
    }
}
</code></pre><p>第6步: 停止所有 shop-product 服务,重启 shop-order 服务,访问请求,观察容错效果</p><p><img src=https://img.maruifu.com/images/2021/01/29/2021-01-29-9.53.43.png alt="截屏2021-01-29 下午9.53.43"><span class=caption>※ 截屏2021-01-29 下午9.53.43</span></p><p><strong>扩展</strong>: 如果想在容错类中拿到具体的错误,可以使用下面的方式</p><pre tabindex=0><code>
package cn.maruifu.service.api;

import cn.maruifu.vo.Product;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
//value用于指定调用nacos下哪个微服务
//fallback用于指定容错类
//@FeignClient(value = &#34;service-product&#34;, fallback = ProductApiServiceFallBack.class)

@FeignClient(   value = &#34;service-product&#34;, fallbackFactory = ProductApiServiceFallBackFactory.class)
//声明调用的提供者的name
public interface ProductApiService {
    //指定调用提供者的哪个方法
//@FeignClient+@GetMapping 就是一个完整的请求路径 http://service- product/product/{pid}
    @GetMapping(value = &#34;/product/{pid}&#34;)
    Product findByPid(@PathVariable(&#34;pid&#34;) Integer pid);
}




package cn.maruifu.service.api;
import cn.maruifu.vo.Product;
import feign.hystrix.FallbackFactory;
import org.springframework.stereotype.Component;
@Component
public class ProductApiServiceFallBackFactory implements FallbackFactory&lt;ProductApiService&gt; {
    @Override
    public ProductApiService create(Throwable throwable) {
        return new ProductApiService() {
            @Override
            public Product findByPid(Integer pid) {
                throwable.printStackTrace();
                Product product = new Product();
                product.setPid(-1);
                return product;
            }
        };
    }
}


  
</code></pre><p><strong>注意: fallback和fallbackFactory只能使用其中一种方式</strong></p></div><ul class=post-copyright><li class="copyright-item author"><span class=copyright-item-text>作者</span>：<a href=https://cuitpanfei.github.io/me/ class="p-author h-card" target=_blank rel=noopener>cuitpanfei</a></li><li class="copyright-item link"><span class=copyright-item-text>链接</span>：<a href=/me/posts/post-305/ target=_blank rel=noopener>https://cuitpanfei.github.io/me/posts/post-305/</a></li><li class="copyright-item license"><span class=copyright-item-text>许可</span>：
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a></li></ul></article><div class=updated-badge-container><span title="Updated @ 2025-09-14 03:07:17 CST" style=cursor:help><svg width="130" height="20" class="updated-badge"><linearGradient id="b" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><clipPath id="a"><rect width="130" height="20" rx="3" fill="#fff"/></clipPath><g clip-path="url(#a)"><path class="updated-badge-left" d="M0 0h55v20H0z"/><path class="updated-badge-right" d="M55 0h75v20H55z"/><path fill="url(#b)" d="M0 0h130v20H0z"/></g><g fill="#fff" text-anchor="middle" font-size="110"><text x="285" y="150" fill="#010101" fill-opacity=".3" textLength="450" transform="scale(.1)">updated</text><text x="285" y="140" textLength="450" transform="scale(.1)">updated</text><text x="915" y="150" fill="#010101" fill-opacity=".3" textLength="650" transform="scale(.1)">2025-09-14</text><text x="915" y="140" textLength="650" transform="scale(.1)">2025-09-14</text></g></svg></span></div><div class=post-share><div class=share-items><div class="share-item weibo"><a href="https://service.weibo.com/share/share.php?&amp;url=https://cuitpanfei.github.io/me/posts/post-305/&amp;title=%0aSentinel--%e6%9c%8d%e5%8a%a1%e5%ae%b9%e9%94%99&amp;pic=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.29.58.png&amp;searchPic=false" title=分享到「新浪微博」 target=_blank rel=noopener><svg viewBox="0 0 512 512" class="icon weibo-icon"><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7.0 395.3.0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg></a></div><div class="share-item douban"><a href="https://www.douban.com/share/service?href=https://cuitpanfei.github.io/me/posts/post-305/&amp;name=%0aSentinel--%e6%9c%8d%e5%8a%a1%e5%ae%b9%e9%94%99&amp;text=%e5%be%ae%e6%9c%8d%e5%8a%a1%0a%e9%ab%98%e5%b9%b6%e5%8f%91%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98%20%e5%9c%a8%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%9e%b6%e6%9e%84%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e5%b0%86%e4%b8%9a%e5%8a%a1%e6%8b%86%e5%88%86%e6%88%90%e4%b8%80%e4%b8%aa%e4%b8%aa%e7%9a%84%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%9c%8d%e5%8a%a1%e4%b8%8e%e6%9c%8d%e5%8a%a1%e4%b9%8b%e9%97%b4%e5%8f%af%e4%bb%a5%e7%9b%b8%e4%ba%92%e8%b0%83%e7%94%a8%ef%bc%8c%e4%bd%86%e6%98%af%e7%94%b1%e4%ba%8e%e7%bd%91%e7%bb%9c%e5%8e%9f%e5%9b%a0%20%e6%88%96%e8%80%85%e8%87%aa%e8%ba%ab%e7%9a%84%e5%8e%9f%e5%9b%a0%ef%bc%8c%e6%9c%8d%e5%8a%a1%e5%b9%b6%e4%b8%8d%e8%83%bd%e4%bf%9d%e8%af%81%e6%9c%8d%e5%8a%a1%e7%9a%84100%25%e5%8f%af%e7%94%a8%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%8d%95%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98%ef%bc%8c%e8%b0%83%e7%94%a8%e8%bf%99%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%b0%b1%e4%bc%9a%e5%87%ba%e7%8e%b0%20%e7%bd%91%e7%bb%9c%e5%bb%b6%e8%bf%9f%ef%bc%8c%e6%ad%a4%e6%97%b6%e8%8b%a5%e6%9c%89%e5%a4%a7%e9%87%8f%e7%9a%84%e7%bd%91%e7%bb%9c%e6%b6%8c%e5%85%a5%ef%bc%8c%e4%bc%9a%e5%bd%a2%e6%88%90%e4%bb%bb%e5%8a%a1%e5%a0%86%e7%a7%af%ef%bc%8c%e6%9c%80%e7%bb%88%e5%af%bc%e8%87%b4%e6%9c%8d%e5%8a%a1%e7%98%ab%e7%97%aa%e3%80%82%0a" title=分享到「豆瓣」 target=_blank rel=noopener><svg viewBox="0 0 24 24" class="icon douban-icon"><path d="M.643.92v2.412h22.714V.92H.643zm1.974 4.926v9.42h18.764v-9.42H2.617zm2.72 2.408H18.69v4.605H5.338V8.254zm1.657 7.412-2.512.938c1.037 1.461 1.87 2.825 2.512 4.091H0v2.385h24v-2.385h-6.678c.818-1.176 1.589-2.543 2.303-4.091l-2.73-.938a29.952 29.952.0 01-2.479 5.03h-4.75c-.786-1.962-1.677-3.641-2.672-5.03z"/></svg></a></div><div class="share-item qq"><a href="https://connect.qq.com/widget/shareqq/index.html?url=https://cuitpanfei.github.io/me/posts/post-305/&amp;title=%0aSentinel--%e6%9c%8d%e5%8a%a1%e5%ae%b9%e9%94%99&amp;summary=%e5%be%ae%e6%9c%8d%e5%8a%a1%0a%e9%ab%98%e5%b9%b6%e5%8f%91%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98%20%e5%9c%a8%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%9e%b6%e6%9e%84%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e5%b0%86%e4%b8%9a%e5%8a%a1%e6%8b%86%e5%88%86%e6%88%90%e4%b8%80%e4%b8%aa%e4%b8%aa%e7%9a%84%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%9c%8d%e5%8a%a1%e4%b8%8e%e6%9c%8d%e5%8a%a1%e4%b9%8b%e9%97%b4%e5%8f%af%e4%bb%a5%e7%9b%b8%e4%ba%92%e8%b0%83%e7%94%a8%ef%bc%8c%e4%bd%86%e6%98%af%e7%94%b1%e4%ba%8e%e7%bd%91%e7%bb%9c%e5%8e%9f%e5%9b%a0%20%e6%88%96%e8%80%85%e8%87%aa%e8%ba%ab%e7%9a%84%e5%8e%9f%e5%9b%a0%ef%bc%8c%e6%9c%8d%e5%8a%a1%e5%b9%b6%e4%b8%8d%e8%83%bd%e4%bf%9d%e8%af%81%e6%9c%8d%e5%8a%a1%e7%9a%84100%25%e5%8f%af%e7%94%a8%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%8d%95%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98%ef%bc%8c%e8%b0%83%e7%94%a8%e8%bf%99%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%b0%b1%e4%bc%9a%e5%87%ba%e7%8e%b0%20%e7%bd%91%e7%bb%9c%e5%bb%b6%e8%bf%9f%ef%bc%8c%e6%ad%a4%e6%97%b6%e8%8b%a5%e6%9c%89%e5%a4%a7%e9%87%8f%e7%9a%84%e7%bd%91%e7%bb%9c%e6%b6%8c%e5%85%a5%ef%bc%8c%e4%bc%9a%e5%bd%a2%e6%88%90%e4%bb%bb%e5%8a%a1%e5%a0%86%e7%a7%af%ef%bc%8c%e6%9c%80%e7%bb%88%e5%af%bc%e8%87%b4%e6%9c%8d%e5%8a%a1%e7%98%ab%e7%97%aa%e3%80%82%0a&amp;pics=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.29.58.png&amp;site=CUITPF" title=分享到「QQ」 target=_blank rel=noopener><svg viewBox="0 0 448 512" class="icon qq-icon"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741.0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792.0.0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg></a></div><div class="share-item qzone"><a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://cuitpanfei.github.io/me/posts/post-305/&amp;title=%0aSentinel--%e6%9c%8d%e5%8a%a1%e5%ae%b9%e9%94%99&amp;summary=%e5%be%ae%e6%9c%8d%e5%8a%a1%0a%e9%ab%98%e5%b9%b6%e5%8f%91%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98%20%e5%9c%a8%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%9e%b6%e6%9e%84%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e5%b0%86%e4%b8%9a%e5%8a%a1%e6%8b%86%e5%88%86%e6%88%90%e4%b8%80%e4%b8%aa%e4%b8%aa%e7%9a%84%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%9c%8d%e5%8a%a1%e4%b8%8e%e6%9c%8d%e5%8a%a1%e4%b9%8b%e9%97%b4%e5%8f%af%e4%bb%a5%e7%9b%b8%e4%ba%92%e8%b0%83%e7%94%a8%ef%bc%8c%e4%bd%86%e6%98%af%e7%94%b1%e4%ba%8e%e7%bd%91%e7%bb%9c%e5%8e%9f%e5%9b%a0%20%e6%88%96%e8%80%85%e8%87%aa%e8%ba%ab%e7%9a%84%e5%8e%9f%e5%9b%a0%ef%bc%8c%e6%9c%8d%e5%8a%a1%e5%b9%b6%e4%b8%8d%e8%83%bd%e4%bf%9d%e8%af%81%e6%9c%8d%e5%8a%a1%e7%9a%84100%25%e5%8f%af%e7%94%a8%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%8d%95%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98%ef%bc%8c%e8%b0%83%e7%94%a8%e8%bf%99%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%b0%b1%e4%bc%9a%e5%87%ba%e7%8e%b0%20%e7%bd%91%e7%bb%9c%e5%bb%b6%e8%bf%9f%ef%bc%8c%e6%ad%a4%e6%97%b6%e8%8b%a5%e6%9c%89%e5%a4%a7%e9%87%8f%e7%9a%84%e7%bd%91%e7%bb%9c%e6%b6%8c%e5%85%a5%ef%bc%8c%e4%bc%9a%e5%bd%a2%e6%88%90%e4%bb%bb%e5%8a%a1%e5%a0%86%e7%a7%af%ef%bc%8c%e6%9c%80%e7%bb%88%e5%af%bc%e8%87%b4%e6%9c%8d%e5%8a%a1%e7%98%ab%e7%97%aa%e3%80%82%0a&amp;pics=https://img.maruifu.com/images/2021/01/29/2021-01-29-8.29.58.png&amp;site=CUITPF" title="分享到「QQ 空间」" target=_blank rel=noopener><svg viewBox="0 0 24 24" class="icon qzone-icon"><path d="M23.985 9.202c-.032-.099-.127-.223-.334-.258-.207-.036-7.351-1.406-7.351-1.406s-.105-.022-.198-.07c-.092-.047-.127-.167-.127-.167S12.447.956 12.349.77C12.25.583 12.104.532 12 .532s-.251.051-.349.238c-.098.186-3.626 6.531-3.626 6.531s-.035.12-.128.167c-.092.047-.197.07-.197.07S.556 8.908.348 8.943c-.208.036-.302.16-.333.258a.477.477.0 00.125.449l5.362 5.49s.072.08.119.172c.016.104.005.21.005.21s-1.189 7.242-1.22 7.45.075.369.159.43c.083.062.233.106.421.013.189-.093 6.812-3.261 6.812-3.261s.098-.044.201-.061.201.061.201.061 6.623 3.168 6.812 3.261c.188.094.338.049.421-.013a.463.463.0 00.159-.43c-.021-.14-.93-5.677-.93-5.677.876-.54 1.425-1.039 1.849-1.747-2.594.969-6.006 1.717-9.415 1.866-.915.041-2.41.097-3.473-.015-.678-.071-1.17-.144-1.243-.438-.053-.215.054-.46.545-.831a2640.5 2640.5.0 012.861-2.155c1.285-.968 3.559-2.47 3.559-2.731.0-.285-2.144-.781-4.037-.781-1.945.0-2.275.132-2.811.168-.488.034-.769.005-.804-.138-.06-.248.183-.389.588-.568.709-.314 1.86-.594 1.984-.626.194-.052 3.082-.805 5.618-.535 1.318.14 3.244.668 3.244 1.276.0.342-1.721 1.494-3.225 2.597-1.149.843-2.217 1.561-2.217 1.688.0.342 3.533 1.241 6.689 1.01l.003-.022c.048-.092.119-.172.119-.172l5.362-5.49a.477.477.0 00.127-.449z"/></svg></a></div><div class="share-item qrcode"><div class=qrcode-container title=通过「二维码」><svg viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id=qrcode-img></div></div><script src=https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js></script><script>const typeNumber=0,errorCorrectionLevel="L",qr=qrcode(typeNumber,errorCorrectionLevel);qr.addData("https://cuitpanfei.github.io/me/posts/post-305/"),qr.make(),document.getElementById("qrcode-img").innerHTML=qr.createImgTag()</script></div><div class="share-item email"><a href="mailto:?subject=%0aSentinel--%e6%9c%8d%e5%8a%a1%e5%ae%b9%e9%94%99&amp;body=%e5%be%ae%e6%9c%8d%e5%8a%a1%0a%e9%ab%98%e5%b9%b6%e5%8f%91%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98%20%e5%9c%a8%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%9e%b6%e6%9e%84%e4%b8%ad%ef%bc%8c%e6%88%91%e4%bb%ac%e5%b0%86%e4%b8%9a%e5%8a%a1%e6%8b%86%e5%88%86%e6%88%90%e4%b8%80%e4%b8%aa%e4%b8%aa%e7%9a%84%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%9c%8d%e5%8a%a1%e4%b8%8e%e6%9c%8d%e5%8a%a1%e4%b9%8b%e9%97%b4%e5%8f%af%e4%bb%a5%e7%9b%b8%e4%ba%92%e8%b0%83%e7%94%a8%ef%bc%8c%e4%bd%86%e6%98%af%e7%94%b1%e4%ba%8e%e7%bd%91%e7%bb%9c%e5%8e%9f%e5%9b%a0%20%e6%88%96%e8%80%85%e8%87%aa%e8%ba%ab%e7%9a%84%e5%8e%9f%e5%9b%a0%ef%bc%8c%e6%9c%8d%e5%8a%a1%e5%b9%b6%e4%b8%8d%e8%83%bd%e4%bf%9d%e8%af%81%e6%9c%8d%e5%8a%a1%e7%9a%84100%25%e5%8f%af%e7%94%a8%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%8d%95%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98%ef%bc%8c%e8%b0%83%e7%94%a8%e8%bf%99%e4%b8%aa%e6%9c%8d%e5%8a%a1%e5%b0%b1%e4%bc%9a%e5%87%ba%e7%8e%b0%20%e7%bd%91%e7%bb%9c%e5%bb%b6%e8%bf%9f%ef%bc%8c%e6%ad%a4%e6%97%b6%e8%8b%a5%e6%9c%89%e5%a4%a7%e9%87%8f%e7%9a%84%e7%bd%91%e7%bb%9c%e6%b6%8c%e5%85%a5%ef%bc%8c%e4%bc%9a%e5%bd%a2%e6%88%90%e4%bb%bb%e5%8a%a1%e5%a0%86%e7%a7%af%ef%bc%8c%e6%9c%80%e7%bb%88%e5%af%bc%e8%87%b4%e6%9c%8d%e5%8a%a1%e7%98%ab%e7%97%aa%e3%80%82%0a%0Ahttps://cuitpanfei.github.io/me/posts/post-305/" title=通过「电子邮件」 target=_blank rel=noopener><svg viewBox="0 0 512 512" class="icon email-icon"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></a></div></div></div><div class=related-posts><h2 class=related-title>相关文章：<svg viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2><ul class=related-list><li class=related-item><a href=/me/posts/post-281/ class=related-link>Seata--分布式事务</a></li><li class=related-item><a href=/me/posts/post-282/ class=related-link>Nacos Config--服务配置</a></li><li class=related-item><a href=/me/posts/post-283/ class=related-link>SMS--短信服务</a></li><li class=related-item><a href=/me/posts/post-296/ class=related-link>Sleuth--链路追踪</a></li><li class=related-item><a href=/me/posts/post-304/ class=related-link>Gateway--服务网关</a></li></ul></div><ul class=post-nav><li class=post-nav-prev><a href=/me/posts/post-304/ rel=prev>&lt;
Gateway--服务网关</a></li><li class=post-nav-next><a href=/me/posts/post-306/ rel=next>Nacos Discovery--服务治理 ></a></li></ul></div></main><div id=back-to-top class=back-to-top><a href=#top aria-label=回到顶部><svg viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>©&nbsp;1969–2025&nbsp;<svg viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;cuitpanfei</div><div class=site-copyright><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a></div><ul class=socials><li class=socials-item><a href=/rss.xml target=_blank rel="external noopener" title=RSS><svg viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg></a></li><li class=socials-item><a href=mailto:1730789103@qq.com target=_blank rel="external noopener" title=Email><svg viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 4e2V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V4e2H48z"/></svg></a></li><li class=socials-item><a href=https://github.com/cuitpanfei target=_blank rel="external noopener" title=GitHub><svg viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></li></ul></div></footer></div><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script><script>let imgNodes=document.querySelectorAll("div.post-body img");imgNodes=Array.from(imgNodes).filter(e=>e.parentNode.tagName!=="A"),mediumZoom(imgNodes,{background:"hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)"})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script></body></html>