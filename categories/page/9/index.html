<!DOCTYPE html>
<html lang="en-us"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>


All Categories | Cuitpanfei Site</title>

    

<link rel="canonical" href="http://localhost:1313/categories/" />



<meta name="author" content="" />
<meta name="description" content="" />



<meta name="generator" content="Hugo 0.150.0">


<meta property="og:url" content="http://localhost:1313/categories/">
  <meta property="og:site_name" content="Cuitpanfei Site">
  <meta property="og:title" content="Categories">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">




  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Categories">




<link rel="stylesheet" href="/css/output.css" />




     

    

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js" integrity="sha256-4EHxtjnR5rL8JzbY12OKQJr81ESm7JBEb49ORPo29AY=" crossorigin="anonymous"></script>
  </head>

  <body x-data="{
    flip: false,
  }">
    
    <div id="dream-global-bg"></div>

    
<nav class="mt-4 lg:mt-8 py-4">

  
  <div class="container flex justify-between px-4">
  
    <section class="flex items-center gap-4">
      <div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title="Flip it!">
        <div class="h-10 rounded-full">
          <img src="/" alt="" />
        </div>
      </div>

      
    </section>

    
    

    <div class="dropdown dropdown-end sm:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square" aria-label="Select an option">
        <ion-icon name="menu" class="text-2xl"></ion-icon>
      </div>
      <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md">
        
























<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="Archives">
    <ion-icon name="archive"></ion-icon>
    Archives
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="All Categories">
    <ion-icon name="grid"></ion-icon>
    All Categories
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="All Tags">
    <ion-icon name="pricetags"></ion-icon>
    All Tags
  </a>
</li>






      </ul>
    </div>
    <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
      

      
      





      
      





      
      





      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="Archives">
  <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="All Categories">
  <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="All Tags">
  <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
</a>


      

      

      
    </section>
  </div>
</nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <div class="front">
          <div class="container">
            


<div class="flex flex-col md:flex-row mt-4">

  <div class="md:basis-[200px] lg:basis-[300px] p-4 prose dark:prose-invert">
    <h1 class="text-2xl">All Categories</h1>
    <p class="text-sm">18 categories</p>
    <div class="flex flex-wrap gap-4 mt-6">
      
      <a href="/categories/docker/" class="badge h-6 no-underline hover:badge-primary">
        Docker
      </a>
      
      <a href="/categories/ide/" class="badge h-6 no-underline hover:badge-primary">
        IDE
      </a>
      
      <a href="/categories/java/" class="badge h-6 no-underline hover:badge-primary">
        Java
      </a>
      
      <a href="/categories/maven/" class="badge h-6 no-underline hover:badge-primary">
        Maven
      </a>
      
      <a href="/categories/nas/" class="badge h-6 no-underline hover:badge-primary">
        NAS
      </a>
      
      <a href="/categories/spring-cloud/" class="badge h-6 no-underline hover:badge-primary">
        Spring Cloud
      </a>
      
      <a href="/categories/springboot/" class="badge h-6 no-underline hover:badge-primary">
        SpringBoot
      </a>
      
      <a href="/categories/%E5%89%8D%E7%AB%AF/" class="badge h-6 no-underline hover:badge-primary">
        前端
      </a>
      
      <a href="/categories/%E5%A5%BD%E7%8E%A9%E6%8A%80%E5%B7%A7/" class="badge h-6 no-underline hover:badge-primary">
        好玩技巧
      </a>
      
      <a href="/categories/%E5%BB%BA%E7%AB%99/" class="badge h-6 no-underline hover:badge-primary">
        建站
      </a>
      
      <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="badge h-6 no-underline hover:badge-primary">
        数据库
      </a>
      
      <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" class="badge h-6 no-underline hover:badge-primary">
        数据结构与算法
      </a>
      
      <a href="/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" class="badge h-6 no-underline hover:badge-primary">
        架构设计
      </a>
      
      <a href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" class="badge h-6 no-underline hover:badge-primary">
        版本控制
      </a>
      
      <a href="/categories/%E8%99%9A%E6%8B%9F%E6%9C%BA/" class="badge h-6 no-underline hover:badge-primary">
        虚拟机
      </a>
      
      <a href="/categories/%E8%AF%AD%E8%A8%80/" class="badge h-6 no-underline hover:badge-primary">
        语言
      </a>
      
      <a href="/categories/%E8%BF%90%E7%BB%B4/" class="badge h-6 no-underline hover:badge-primary">
        运维
      </a>
      
      <a href="/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/" class="badge h-6 no-underline hover:badge-primary">
        默认分类
      </a>
      
    </div>
  </div>
  
  <div class="divider divider-vertical md:divider-horizontal px-4 md:px-0"></div>
  
  <div class="flex-1">
    

    
    <div class="dream-grid">
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-15/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default4_hu_ae815e0f1649c253.webp" type="image/webp" />
      <img src="/images/default4.jpg" alt="/images/default4.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">FreeMarker首次渲染文件（并发），部分线程报中断异常</h2>

    <p class="date text-base-content/60">
    
      Friday, Jun 11, 2021
    
    </p>

    <h1 id="问题在使用freemarker时遇见了一个问题">问题，在使用FreeMarker时遇见了一个问题</h1>
<p>**现象：**在服务启动后，第一次渲染文件（多线程并发进行）时，出现部分线程报中断异常，再次触发时正常完成渲染。</p>
<p>详细内容见代码的HELP.md</p>
<h1 id="问题复现代码地址">问题复现代码地址：</h1>
<p><a href="https://www.pfinfo.com.cn/blog/upload/2021/06/0cv4s1umsujfqrlal4rcppr684.zip" target="_blank">https://www.pfinfo.com.cn/blog/upload/2021/06/0cv4s1umsujfqrlal4rcppr684.zip</a>
</p>
<p>测试入口：
DemoApplicationTests#template()</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>1 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-289/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default4_hu_ae815e0f1649c253.webp" type="image/webp" />
      <img src="/images/default4.jpg" alt="/images/default4.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Kubernetes简介和安装</h2>

    <p class="date text-base-content/60">
    
      Wednesday, Jun 2, 2021
    
    </p>

    <p><a href="/tag/Kubernetes">Kubernetes</a>
<a href="/tag/docker">docker</a>
</p>



  <blockquote>
    <p>What is Kubernetes？</p>
<p>Kubernetes这个单词来自于希腊语，含义是 舵手 或 领航员</p>
  </blockquote>

<h2 id="简介说明">简介说明</h2>
<p>Production-Grade Container Orchestration Automated container deployment, scaling, and management</p>
<p>生产级的容器编排 自动化的容器部署、扩展和管理</p>
<p>Kubernetes，也称为K8S，其中8是代表中间“ubernete”的8个字符，是Google在2014年开源的一个容器编排引擎，用于自动化容器化应用程序的部署、规划、扩展和管理，它将组成应用程序的容器分组为逻辑单元，以便于管理和发现，用于管理云平台中多个主机上的容器化的应用，Kubernetes 的目标是让部署容器化的应用简单并且高效，很多细节都不需要运维人员去进行复杂的手工配置和处理；</p>
<p>Kubernetes拥有Google在生产环境上15年运行的经验，并结合了社区中最佳实践；</p>
<p>K8S是 <a href="https://cncf.io/" target="_blank">CNCF</a>
 毕业的项目，本来Kubernetes是Google的内部项目，后来开源出来，又后来为了其茁壮成长，捐给了CNCF；</p>
<p>CNCF全称Cloud Native Computing Foundation（云原生计算基金会）</p>
<p>官网：https://kubernetes.io/</p>
<p>代码：https://github.com/kubernetes/kubernetes</p>
<p>Kubernetes是采用Go语言开发的，Go语言是谷歌2009发布的一款开源编程语言；</p>



  <blockquote>
    <p>编排是什么意思？</p>
<ol>
<li>
<p>按照一定的目的依次排列；</p>
</li>
<li>
<p>调配、安排；</p>
</li>
</ol>
  </blockquote>

<h2 id="整体架构">整体架构</h2>
<p><img src="https://img.maruifu.com/images/2021/06/02/2021-06-02-11.40.05.png" alt="截屏2021-06-02 下午11.40.05" title="截屏2021-06-02 下午11.40.05"></p>
<h3 id="master"><strong>Master</strong></h3>
<p>k8s集群控制节点，对集群进行调度管理，接受集群外用户去集群操作请求；</p>
<p>Master Node 由 API Server、Scheduler、ClusterState Store（ETCD 数据库）和 Controller MangerServer 所组成；</p>
<h3 id="nodes"><strong>Nodes</strong></h3>
<p>集群工作节点，运行用户业务应用容器；</p>
<p>Nodes节点也叫Worker Node，包含kubelet、kube proxy 和 Pod（Container Runtime）；</p>
<h2 id="搭建方式">搭建方式</h2>
<p>部署 Kubernetes 环境（集群）主要有多种方式：</p>
<ol>
<li>minikube</li>
</ol>
<p>minikube可以在本地运行Kubernetes的工具，minikube可以在个人计算机（包括Windows，macOS和Linux PC）上运行一个单节点Kubernetes集群，以便您可以试用Kubernetes或进行日常开发工作；</p>
<p><a href="https://kubernetes.io/docs/tutorials/hello-minikube/" target="_blank">https://kubernetes.io/docs/tutorials/hello-minikube/</a>
</p>
<ol start="2">
<li>kind</li>
</ol>
<p>Kind和minikube类似的工具，让你在本地计算机上运行Kubernetes，此工具需要安装并配置Docker；</p>
<p><a href="https://kind.sigs.k8s.io/" target="_blank">https://kind.sigs.k8s.io/</a>
</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>6 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-290/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default3_hu_599e07ea93afc07d.webp" type="image/webp" />
      <img src="/images/default3.jpg" alt="/images/default3.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Mac VM CentOS7配置静态IP</h2>

    <p class="date text-base-content/60">
    
      Sunday, May 30, 2021
    
    </p>

    <h2 id="把网络配置改成nat模式">把网络配置改成nat模式</h2>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164805904-1878811384.png" alt="720430-20190610164805904-1878811384" title="720430-20190610164805904-1878811384"></p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164812040-64855612.png" alt="720430-20190610164812040-64855612" title="720430-20190610164812040-64855612"></p>
<h2 id="获取网关地址和子网掩码">获取网关地址和子网掩码</h2>
<p>通过Mac终端进入VMware Fusion的vmnet8目录</p>
<pre tabindex="0"><code>cd /Library/Preferences/VMware\ Fusion/vmnet8
</code></pre><p>查看nat.conf</p>
<pre tabindex="0"><code>cat nat.conf
</code></pre><p>记住红框中的数据，下面配置时需要用到</p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164827222-1773170825.png" alt="720430-20190610164827222-1773170825" title="720430-20190610164827222-1773170825"></p>
<h2 id="获取可用ip地址">获取可用IP地址</h2>
<p>查看cat dhcpd.conf</p>
<pre tabindex="0"><code>cat dhcpd.conf
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164835758-181641312.png" alt="720430-20190610164835758-181641312" title="720430-20190610164835758-181641312"></p>



  <blockquote>
    <p>注意range 这个是虚拟机允许选择的静态ip地址范围，自定义的静态ip地址必须要在这个范围内(本文打算使用172.16.104.130为例介绍)</p>
  </blockquote>

<h2 id="获取dns1地址">获取DNS1地址</h2>
<p>mac系统偏好设置—&gt;网络—&gt;</p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164843039-18488902.png" alt="720430-20190610164843039-18488902" title="720430-20190610164843039-18488902"></p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164849104-441757788.png" alt="720430-20190610164849104-441757788" title="720430-20190610164849104-441757788"></p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164855065-1139533275.png" alt="720430-20190610164855065-1139533275" title="720430-20190610164855065-1139533275"></p>
<h2 id="配置centos7网络配置">配置CentOS7网络配置</h2>
<p>登录CentOS7进入虚拟机的network-scripts目录</p>
<pre tabindex="0"><code>cd /etc/sysconfig/network-scripts
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164947943-1391299598.png" alt="720430-20190610164947943-1391299598" title="720430-20190610164947943-1391299598"></p>
<p>找到ifcfg-en开头的文件,上图中我的是ifcfg-ens33</p>
<p>通过vi编辑该文件</p>
<p>下图是默认配置</p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610164955215-574987874.png" alt="720430-20190610164955215-574987874" title="720430-20190610164955215-574987874"></p>
<p>我们将它改成如下配置</p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610165000839-393578534.png" alt="720430-20190610165000839-393578534" title="720430-20190610165000839-393578534"></p>
<h2 id="重启服务使修改生效">重启服务使修改生效</h2>
<pre tabindex="0"><code>service network restart
</code></pre><h2 id="测试配置是否成功">测试配置是否成功</h2>
<p>ping一下百度看看，成功Ping到</p>
<p><img src="https://img.maruifu.com/images/2021/05/30/720430-20190610165009727-1011741530.png" alt="720430-20190610165009727-1011741530" title="720430-20190610165009727-1011741530"></p>
<h2 id="其他网络上网连接问题">其他网络上网连接问题</h2>
<p>接下来我们就可以通过SecureCRT等工具远程连接了，有一点请记住，如果你换了一个地方上网的话，可能会发现你的虚拟机有不通了，那是因为DNS地址发生了变化，此时只需要再次编辑ifcfg-enxxx文件，然后加上你现在网络的DNS地址即可</p>
<p>如:</p>
<pre tabindex="0"><code>DNS1=192.168.0.1
DNS2=114.114.114.114
</code></pre><p>我们通过SecureCRT连接测试一下</p>
<p><img src="https://img.maruifu.com/images/2021/05/30/2021-05-30-11.35.08.png" alt="截屏2021-05-30 下午11.35.08" title="截屏2021-05-30 下午11.35.08"></p>
<h2 id="其他命令">其他命令</h2>
<pre tabindex="0"><code>ifconfig  #查询自己的IP地址

netstat -rn #查询自己的默认网关和 #子网掩码

cat /etc/resolv.conf #查询自己的 DNS 配置
</code></pre>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>1 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-291/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default1_hu_33478ca164b4fce4.webp" type="image/webp" />
      <img src="/images/default1.jpg" alt="/images/default1.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Docker-常用安装与镜像发布到阿里云（四）</h2>

    <p class="date text-base-content/60">
    
      Sunday, May 16, 2021
    
    </p>

    <p><a href="/tag/Docker">Docker</a>
</p>
<h2 id="docker常用安装">Docker常用安装</h2>
<h3 id="总体步骤">总体步骤</h3>
<p>搜索镜像-&gt;拉取镜像-&gt;查看镜像-&gt;启动镜像-&gt;停止容器-&gt;移除容器</p>
<h3 id="安装tomcat">安装tomcat</h3>
<p>1.docker hub上面查找tomcat镜像</p>
<p><code>docker search tomcat</code></p>
<p>2.从docker hub上拉取tomcat镜像到本地</p>
<p><code>docker pull tomcat</code></p>
<p>官网命令：</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516183353962.png" alt="image-20210516183353962" title="image-20210516183353962"></p>
<p>3.docker images查看是否有拉取到的tomcat</p>
<p><code>docker images</code></p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516183459819.png" alt="image-20210516183459819" title="image-20210516183459819"></p>
<p>4.使用tomcat镜像创建容器(也叫运行镜像)</p>
<pre tabindex="0"><code>docker run -it -p 8080:8080 tomcat
#  -p 主机端口:docker容器端口
#  -P 随机分配端口
#  i:交互
#  t:终端
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516183704111.png" alt="image-20210516183704111" title="image-20210516183704111"></p>
<h3 id="安装mysql">安装mysql</h3>
<ol>
<li>docker hub上面查找mysql镜像</li>
</ol>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516183851636.png" alt="image-20210516183851636" title="image-20210516183851636"></p>
<ol start="2">
<li>从docker hub上(阿里云加速器)拉取mysql镜像到本地标签为5.6</li>
</ol>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516183908178.png" alt="image-20210516183908178" title="image-20210516183908178"></p>
<ol start="3">
<li>
<p>使用mysql5.6镜像创建容器(也叫运行镜像)</p>
<p>使用mysql镜像</p>
<pre tabindex="0"><code>docker run -p 12345:3306 --name mysql -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -v /zzyyuse/mysql/logs:/logs -v /zzyyuse/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6

#命令说明：
#-p 12345:3306：将主机的12345端口映射到docker容器的3306端口。
#--name mysql：运行服务名字
#-v /zzyyuse/mysql/conf:/etc/mysql/conf.d ：将主机/zzyyuse/mysql录下的conf/my.cnf 挂载到容器的 /etc/mysql/conf.d
#-v /zzyyuse/mysql/logs:/logs：将主机/zzyyuse/mysql目录下的 logs 目录挂载到容器的 /logs。
#-v /zzyyuse/mysql/data:/var/lib/mysql ：将主机/zzyyuse/mysql目录下的data目录挂载到容器的 /var/lib/mysql 
#-e MYSQL_ROOT_PASSWORD=123456：初始化 root 用户的密码。
#-d mysql:5.6 : 后台程序运行mysql5.6

docker exec -it MySQL运行成功后的容器ID     /bin/bash
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516184120015.png" alt="image-20210516184120015" title="image-20210516184120015"></p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>40 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-292/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default2_hu_c96b8a8cc3f55f81.webp" type="image/webp" />
      <img src="/images/default2.jpg" alt="/images/default2.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Docker-容器数据卷与DockerFile解析（三）</h2>

    <p class="date text-base-content/60">
    
      Sunday, May 16, 2021
    
    </p>

    <p><a href="/tag/Docker">Docker</a>
</p>
<h2 id="docker容器数据卷">Docker容器数据卷</h2>
<h3 id="是什么">是什么？</h3>
<p>先来看看Docker的理念：</p>
<ul>
<li>
<p>将运用与运行的环境打包形成容器运行 ，运行可以伴随着容器，但是我们对数据的要求希望是持久化的</p>
</li>
<li>
<p>容器之间希望有可能共享数据</p>
</li>
</ul>
<p>Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。</p>
<p>为了能保存数据在docker中我们使用卷。</p>



  <blockquote>
    <p>一句话：有点类似我们Redis里面的rdb和aof文件</p>
  </blockquote>

<h3 id="能干嘛">能干嘛？</h3>
<p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性：</p>
<p>卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷</p>
<p>特点：</p>
<ul>
<li>
<p>数据卷可在容器之间共享或重用数据</p>
</li>
<li>
<p>卷中的更改可以直接生效</p>
</li>
<li>
<p>数据卷中的更改不会包含在镜像的更新中</p>
</li>
<li>
<p>数据卷的生命周期一直持续到没有容器使用它为止</p>
</li>
</ul>
<p>容器的持久化</p>
<p>容器间继承+共享数据</p>
<h3 id="数据卷">数据卷</h3>
<h4 id="容器内直接命令添加">容器内直接命令添加</h4>
<p><strong>命令</strong></p>
<pre tabindex="0"><code>docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名 /bin/bash
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516171354850.png" alt="image-20210516171354850" title="image-20210516171354850"></p>
<p><strong>查看数据卷是否挂载成功</strong></p>
<pre tabindex="0"><code>docker inspect 容器ID
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516171618318.png" alt="image-20210516171618318" title="image-20210516171618318"></p>
<p><strong>容器和宿主机之间数据共享</strong></p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516171656699.png" alt="image-20210516171656699" title="image-20210516171656699"></p>
<p><strong>容器停止退出后，主机修改后数据是否同步</strong></p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516171808915.png" alt="image-20210516171808915" title="image-20210516171808915"></p>
<pre tabindex="0"><code>docker run -it -v /宿主机绝对路径目录:/容器内目录:ro 镜像名
</code></pre><p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516171926048.png" alt="image-20210516171926048" title="image-20210516171926048"></p>
<h4 id="dockerfile添加">DockerFile添加</h4>
<ul>
<li>
<p>根目录下新建mydocker文件夹并进入</p>
</li>
<li>
<p>可在Dockerfile中使用VOLUME指令来给镜像添加一个或多个数据卷</p>
</li>
</ul>



  <blockquote>
    <p>VOLUME[&quot;/dataVolumeContainer&quot;,&quot;/dataVolumeContainer2&quot;,&quot;/dataVolumeContainer3&quot;]</p>
<p>说明：</p>
<p>出于可移植和分享的考虑，用-v 主机目录:容器目录这种方法不能够直接在Dockerfile中实现。</p>
<p>由于宿主机目录是依赖于特定宿主机的，并不能够保证在所有的宿主机上都存在这样的特定目录。</p>
  </blockquote>

<ul>
<li>File构建</li>
</ul>
<pre tabindex="0"><code>[root@maruifu mydocker]# pwd
/mydocker
[root@maruifu mydocker]# cat dockerfile2
# volume test
FROM centos
VOLUME [&#34;/dataVolumeContainer1&#34;,&#34;/dataVolumeContainer2&#34;]
CMD echo &#34;finished,--------success1&#34;
CMD /bin/bash
</code></pre><ul>
<li>build后生成镜像 <img src="https://img.maruifu.com/images/2021/05/16/image-20210516172322321.png" alt="image-20210516172322321" title="image-20210516172322321"></li>
</ul>
<p>获得一个新镜像zzyy/centos</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>3 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-293/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default3_hu_599e07ea93afc07d.webp" type="image/webp" />
      <img src="/images/default3.jpg" alt="/images/default3.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Docker-命令与镜像（二）</h2>

    <p class="date text-base-content/60">
    
      Sunday, May 16, 2021
    
    </p>

    <p><a href="/tag/Docker">Docker</a>
</p>
<h2 id="docker常用命令">Docker常用命令</h2>
<h3 id="帮助命令">帮助命令</h3>
<pre tabindex="0"><code>docker version
docker info
docker --help
</code></pre><h3 id="镜像命令">镜像命令</h3>
<ol>
<li>
<p>列出本地主机上的镜像</p>
<pre tabindex="0"><code>docker images
#各个选项说明:
#    - REPOSITORY：表示镜像的仓库源
#    - TAG：镜像的标签
#    - IMAGE ID：镜像ID
#    - CREATED：镜像创建时间
#    - SIZE：镜像大小
#同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。
#如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像

#OPTIONS说明
#   - -a :列出本地所有的镜像（含中间映像层）
#   - -q :只显示镜像ID。
#   - --digests :显示镜像的摘要信息
#   - --no-trunc :显示完整的镜像信息
</code></pre></li>
<li>
<p>docker search 某个XXX镜像名字</p>
<pre tabindex="0"><code>#地址：https://hub.docker.com
docker search [OPTIONS] 镜像名字
# OPTIONS说明：
#    --no-trunc : 显示完整的镜像描述
#    -s : 列出收藏数不小于指定值的镜像。
#    --automated : 只列出 automated build类型的镜像；
</code></pre></li>
<li>
<p>docker pull 某个XXX镜像名字</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>4 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-294/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default2_hu_c96b8a8cc3f55f81.webp" type="image/webp" />
      <img src="/images/default2.jpg" alt="/images/default2.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Docker-简介与安装（一）</h2>

    <p class="date text-base-content/60">
    
      Sunday, May 16, 2021
    
    </p>

    <p><a href="/tag/Docker">Docker</a>
</p>
<h2 id="docker简介">Docker简介</h2>
<h3 id="是什么">是什么？</h3>
<h4 id="为什么会有docker">为什么会有docker？</h4>
<p>一款产品从开发到上线，从操作系统，到运行环境，再到应用配置。作为开发+运维之间的协作我们需要关心很多东西，这也是很多互联网公司都不得不面对的问题，特别是各种版本的迭代之后，不同版本环境的兼容，对运维人员都是考验</p>
<p>Docker之所以发展如此迅速，也是因为它对此给出了一个标准化的解决方案。</p>
<p>环境配置如此麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原始环境一模一样地复制过来。开发人员利用 Docker 可以消除协作编码时“在我的机器上可正常工作”的问题。</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516150107135.png" alt="image-20210516150107135" title="image-20210516150107135"></p>
<p>之前在服务器配置一个应用的运行环境，要安装各种软件，就拿尚硅谷电商项目的环境来说吧，Java/Tomcat/MySQL/JDBC驱动包等。安装和配置这些东西有多麻烦就不说了，它还不能跨平台。假如我们是在 Windows 上安装的这些环境，到了 Linux 又得重新装。况且就算不跨操作系统，换另一台同样操作系统的服务器，要移植应用也是非常麻烦的。</p>
<p>传统上认为，软件编码开发/测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，开发需要清楚的告诉运维部署团队，用的全部配置文件+所有软件环境。不过，即便如此，仍然常常发生部署失败的状况。Docker镜像的设计，使得Docker得以打破过去「程序即应用」的观念。透过镜像(images)将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运作。</p>
<h4 id="docker理念">docker理念？</h4>
<p>Docker是基于Go语言实现的云开源项目。</p>
<p>Docker的主要目标是“Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“一次封装，到处运行”。</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516150211066.png" alt="image-20210516150211066" title="image-20210516150211066"></p>
<p>Linux 容器技术的出现就解决了这样一个问题，而 Docker 就是在它的基础上发展过来的。将应用运行在 Docker 容器上面，而 Docker 容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作</p>



  <blockquote>
    <p>一句话解决了运行环境和配置问题软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术。</p>
  </blockquote>

<h3 id="能干嘛">能干嘛？</h3>
<h4 id="之前的虚拟机技术">之前的虚拟机技术</h4>
<p>虚拟机（virtual machine）就是带环境安装的一种解决方案。</p>
<p>它可以在一种操作系统里面运行另一种操作系统，比如在Windows 系统里面运行Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序，操作系统和硬件三者之间的逻辑不变。</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516150346488bb749b9f50392824.png" alt="image-20210516150346488" title="image-20210516150346488"> 虚拟机的缺点：</p>
<ul>
<li>资源占用多</li>
<li>冗余步骤多</li>
<li>启动慢</li>
</ul>
<h4 id="容器虚拟化技术">容器虚拟化技术</h4>
<p>由于前面虚拟机存在这些缺点，Linux 发展出了另一种虚拟化技术：Linux 容器（Linux Containers，缩写为 LXC）。</p>
<p>Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。有了容器，就可以将软件运行所需的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和设置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一的运行</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/image-20210516150502633.png" alt="image-20210516150502633" title="image-20210516150502633"></p>
<p>比较了 Docker 和传统虚拟化方式的不同之处：</p>
<ul>
<li>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；</li>
<li>而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</li>
<li>每个容器之间互相隔离，每个容器有自己的文件系统 ，容器之间进程不会相互影响，能区分计算资源。</li>
</ul>
<h4 id="开发运维devops">开发/运维(DevOps)</h4>
<p>一次构建，随处运行</p>
<ol>
<li>更快速的应用交付和部署</li>
</ol>
<p>传统的应用开发完成后，需要提供一堆安装程序和配置说明文档，安装部署后需根据配置文档进行繁杂的配置才能正常运行。Docker化之后只需要交付少量容器镜像文件，在正式生产环境加载镜像并运行即可，应用安装配置在镜像里已经内置好，大大节省部署配置和测试验证时间。</p>
<ol start="2">
<li>更便捷的升级和扩缩容</li>
</ol>
<p>随着微服务架构和Docker的发展，大量的应用会通过微服务方式架构，应用的开发构建将变成搭乐高积木一样，每个Docker容器将变成一块“积木”，应用的升级将变得非常容易。当现有的容器不足以支撑业务处理时，可通过镜像运行新的容器进行快速扩容，使应用系统的扩容从原先的天级变成分钟级甚至秒级。</p>
<ol start="3">
<li>更简单的系统运维</li>
</ol>
<p>应用容器化运行后，生产环境运行的应用可与开发、测试环境的应用高度一致，容器会将应用程序相关的环境和状态完全封装起来，不会因为底层基础架构和操作系统的不一致性给应用带来影响，产生新的BUG。当出现程序异常时，也可以通过测试环境的相同容器进行快速定位和修复。</p>
<ol start="4">
<li>更高效的计算资源利用</li>
</ol>
<p>　Docker是内核级虚拟化，其不像传统的虚拟化技术一样需要额外的Hypervisor支持，所以在一台物理机上可以运行很多个容器实例，可大大提升物理服务器的CPU和内存的利用率。</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>2 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-295/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default2_hu_c96b8a8cc3f55f81.webp" type="image/webp" />
      <img src="/images/default2.jpg" alt="/images/default2.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Rocketmq--消息驱动</h2>

    <p class="date text-base-content/60">
    
      Sunday, May 16, 2021
    
    </p>

    <p><a href="/tag/MQ">MQ</a>
</p>
<h2 id="mq简介"><strong>MQ简介</strong></h2>
<h3 id="什么是mq">什么是MQ</h3>
<p>MQ(Message Queue)是一种跨进程的通信机制，用于传递消息。通俗点说，就是一个先进先出的数</p>
<p>据结构。</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/2021-05-15-11.10.15-20210516110622520.png" alt="2021-05-15-11.10.15" title="2021-05-15-11.10.15"></p>
<h3 id="mq的应用场景"><strong>MQ的应用场景</strong></h3>
<h4 id="异步解耦"><strong>异步解耦</strong></h4>
<p>最常见的一个场景是用户注册后，需要发送注册邮件和短信通知，以告知用户注册成功。传统的做法如 下:</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/2021-05-15-11.11.17-20210516110727506.png" alt=""></p>
<p>此架构下注册、邮件、短信三个任务全部完成后，才返回注册结果到客户端，用户才能使用账号登录。 但是对于用户来说，注册功能实际只需要注册系统存储用户的账户信息后，该用户便可以登录，而后续 的注册短信和邮件不是即时需要关注的步骤。</p>
<p>所以实际当数据写入注册系统后，注册系统就可以把其他的操作放入对应的消息队列 MQ 中然后马上返 回用户结果，由消息队列 MQ 异步地进行这些操作。架构图如下:</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/2021-05-15-11.11.38.png" alt=""></p>
<p>异步解耦是消息队列 MQ 的主要特点，主要目的是减少请求响应时间和解耦。主要的使用场景就是将<strong>比 较耗时而且不需要即时(同步)返回结果</strong>的操作作为消息放入消息队列。同时，由于使用了消息队列 MQ，只要保证消息格式不变，消息的发送方和接收方并不需要彼此联系，也不需要受对方的影响，即 解耦合。</p>
<h4 id="流量削峰"><strong>流量削峰</strong></h4>
<p>流量削峰也是消息队列 MQ 的常用场景，一般在秒杀或团队抢购(高并发)活动中使用广泛。在秒杀或团 队抢购活动中，由于用户请求量较大，导致流量暴增，秒杀的应用在处理如此大量的访问流量后，下游 的通知系统无法承载海量的调用量，甚至会导致系统崩溃等问题而发生漏通知的情况。为解决这些问 题，可在应用和下游通知系统之间加入消息队列 MQ。</p>
<p><img src="https://img.maruifu.com/images/2021/05/16/2021-05-15-11.12.12.png" alt=""></p>
<p><strong>秒杀处理流程如下所述:</strong></p>
<ol>
<li>
<p>用户发起海量秒杀请求到秒杀业务处理系统。</p>
</li>
<li>
<p>秒杀处理系统按照秒杀处理逻辑将满足秒杀条件的请求发送至消息队列 MQ。</p>
</li>
<li>
<p>下游的通知系统订阅消息队列 MQ 的秒杀相关消息，再将秒杀成功的消息发送到相应用户。</p>
</li>
<li>
<p>用户收到秒杀成功的通知。</p>
</li>
</ol>
<h3 id="常见的mq产品"><strong>常见的MQ产品</strong></h3>
<p>目前业界有很多MQ产品，比较出名的有下面这些:</p>
<ul>
<li><strong>ZeroMQ</strong></li>
</ul>
<p>号称最快的消息队列系统，尤其针对大吞吐量的需求场景。扩展性好，开发比较灵活，采用C语言实 现，实际上只是一个socket库的重新封装，如果做为消息队列使用，需要开发大量的代码。ZeroMQ仅 提供非持久性的队列，也就是说如果down机，数据将会丢失。</p>
<ul>
<li><strong>RabbitMQ</strong></li>
</ul>
<p>使用erlang语言开发，性能较好，适合于企业级的开发。但是不利于做二次开发和维护。</p>
<ul>
<li><strong>ActiveMQ</strong></li>
</ul>
<p>历史悠久的Apache开源项目。已经在很多产品中得到应用，实现了JMS1.1规范，可以和spring-jms轻 松融合，实现了多种协议，支持持久化到数据库，对队列数较多的情况支持不好。</p>
<ul>
<li><strong>RocketMQ</strong></li>
</ul>
<p>阿里巴巴的MQ中间件，由java语言开发，性能非常好，能够撑住双十一的大流量，而且使用起来很简 单。</p>
<ul>
<li><strong>Kafka</strong></li>
</ul>
<p>Kafka是Apache下的一个子项目，是一个高性能跨语言分布式Publish/Subscribe消息队列系统，相对 于ActiveMQ是一个非常轻量级的消息系统，除了性能非常好之外，还是一个工作良好的分布式系统。</p>
<h2 id="rocketmq入门"><strong>RocketMQ入门</strong></h2>
<p>RocketMQ是阿里巴巴开源的分布式消息中间件，现在是Apache的一个顶级项目。在阿里内部使用非常广泛，已经经过了&quot;双11&quot;这种万亿级的消息流转。</p>
<h3 id="rocketmq环境搭建"><strong>RocketMQ环境搭建</strong></h3>
<p>接下来我们先在linux平台下安装一个RocketMQ的服务</p>
<h4 id="环境准备"><strong>环境准备</strong></h4>
<p><strong>下载RocketMQ</strong></p>
<p><a href="http://rocketmq.apache.org/release" target="_blank">http://rocketmq.apache.org/release</a>
_notes/release-notes-4.4.0/</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>5 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-296/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default4_hu_ae815e0f1649c253.webp" type="image/webp" />
      <img src="/images/default4.jpg" alt="/images/default4.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">Sleuth--链路追踪</h2>

    <p class="date text-base-content/60">
    
      Saturday, May 15, 2021
    
    </p>

    <p><a href="/tag/%E5%BE%AE%E6%9C%8D%E5%8A%A1">微服务</a>
</p>
<h2 id="链路追踪介绍">链路追踪介绍</h2>
<p>在大型系统的微服务化构建中，一个系统被拆分成了许多模块。这些模块负责不同的功能，组合成系 统，最终可以提供丰富的功能。在这种架构中，一次请求往往需要涉及到多个服务。互联网应用构建在 不同的软件模块集上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、 有可能布在了几千台服务器，横跨多个不同的数据中心，也就意味着这种架构形式也会存在一些问题:</p>
<ul>
<li>如何快速发现问题?</li>
<li>如何判断故障影响范围?</li>
<li>如何梳理服务依赖以及依赖的合理性?</li>
<li>如何分析链路性能问题以及实时容量规划?</li>
</ul>
<p><img src="https://img.maruifu.com/images/2021/05/15/2021-05-15-10.36.34.png" alt="链路追踪介绍" title="链路追踪介绍"></p>
<p>分布式链路追踪(Distributed Tracing)，就是将一次分布式请求还原成调用链路，进行日志记录，性 能监控并将一次分布式请求的调用情况集中展示。比如各个服务节点上的耗时、请求具体到达哪台机器 上、每个服务节点的请求状态等等。</p>
<p>常见的链路追踪技术有下面这些:</p>
<ul>
<li><strong>cat</strong> 由大众点评开源，基于Java开发的实时应用监控平台，包括实时应用监控，业务监控 。 集成 方案是通过代码埋点的方式来实现监控，比如: 拦截器，过滤器等。 对代码的侵入性很大，集成 成本较高。风险较大。</li>
<li><strong>zipkin</strong> 由Twitter公司开源，开放源代码分布式的跟踪系统，用于收集服务的定时数据，以解决微 服务架构中的延迟问题，包括:数据的收集、存储、查找和展现。该产品结合spring-cloud-sleuth 使用较为简单， 集成很方便， 但是功能较简单。</li>
<li><strong>pinpoint</strong> :Pinpoint是韩国人开源的基于字节码注入的调用链分析，以及应用监控分析工具。特点 是支持多种插件，UI功能强大，接入端无代码侵入。</li>
<li><strong>skywalking</strong>:SkyWalking是本土开源的基于字节码注入的调用链分析，以及应用监控分析工具。 特点是支持多种插件，UI功能较强，接入端无代码侵入。目前已加入Apache孵化器。</li>
<li><strong>Sleuth</strong>:SpringCloud 提供的分布式系统中链路追踪解决方案。</li>
</ul>



  <blockquote>
    <p><strong>注意:SpringCloud alibaba</strong>技术栈中并没有提供自己的链路追踪技术的，我们可以采用<strong>Sleuth +Zinkin</strong>来做链路追踪解决方案</p>
  </blockquote>

<h2 id="sleuth入门">Sleuth入门</h2>
<h3 id="sleuth介绍">Sleuth介绍</h3>
<p>SpringCloud Sleuth主要功能就是在分布式系统中提供追踪解决方案。它大量借用了Google Dapper的 设计， 先来了解一下Sleuth中的术语和相关概念。</p>
<p><strong>Trace</strong> 由一组Trace Id相同的Span串联形成一个树状结构。为了实现请求跟踪，当请求到达分布式系统 的入口端点时，只需要服务跟踪框架为该请求创建一个唯一的标识(即TraceId)，同时在分布式系统 内部流转的时候，框架始终保持传递该唯一值，直到整个请求的返回。那么我们就可以使用该唯一标识 将所有的请求串联起来，形成一条完整的请求链路。</p>
<p><strong>Span</strong> 代表了一组基本的工作单元。为了统计各处理单元的延迟，当请求到达各个服务组件的时候，也 通过一个唯一标识(SpanId)来标记它的开始、具体过程和结束。通过SpanId的开始和结束时间戳， 就能统计该span的调用时间，除此之外，我们还可以获取如事件的名称。请求信息等元数据。</p>
<p><strong>Annotation</strong></p>
<p>用它记录一段时间内的事件，内部使用的重要注释:</p>
<ul>
<li>cs(Client Send)客户端发出请求，开始一个请求的生命</li>
<li>sr(Server Received)服务端接受到请求开始进行处理， sr-cs = 网络延迟(服务调用的时间)</li>
<li>ss(Server Send)服务端处理完毕准备发送到客户端，ss - sr = 服务器上的请求处理时间</li>
<li>cr(Client Reveived)客户端接受到服务端的响应，请求结束。 cr - sr = 请求的总时间</li>
</ul>
<p><img src="https://img.maruifu.com/images/2021/05/15/2021-05-15-10.40.39.png" alt="Annotation" title="Annotation"></p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>3 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
        <div class="w-full md:w-1/2 lg:w-1/3 p-4 dream-column">
          <a class="card bg-base-100 hover:bg-base-content/10 shadow-xl cursor-pointer dark:border dark:border-base-content/30" href="/posts/post-297/">
  
  <figure>
    
    
    <picture>
      <source srcset="/images/default2_hu_c96b8a8cc3f55f81.webp" type="image/webp" />
      <img src="/images/default2.jpg" alt="/images/default2.jpg" />
    </picture>
    
  </figure>
  

  <div class="card-body">
    <h2 class="card-title">秒懂QPS、TPS、PV、UV、GMV、IP、RPS</h2>

    <p class="date text-base-content/60">
    
      Sunday, Mar 28, 2021
    
    </p>

    <blockquote>
    <p>QPS、TPS、PV、UV、GMV、IP、RPS等各种名词，外行看起来很牛X，实际上每个程序员都是必懂知识点。下面我来一一解释一下。</p>
  </blockquote>

<h2 id="qps"><strong>QPS</strong></h2>
<p>Queries Per Second，每秒查询数。每秒能够响应的查询次数。</p>
<p>QPS 是一台服务器每秒能够相应的查询次数，即1秒内完成的请求数量，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准</p>
<p>QPS是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准，在因特网上，作为域名系统服务器的机器的性能经常用每秒查询率来衡量。每秒的响应请求数，也即是最大<strong>吞吐能力</strong>。</p>
<h2 id="tps"><strong>TPS</strong></h2>
<p>Transactions Per Second 的缩写，每秒处理的事务数目。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数，最终利用这些信息作出的评估分。</p>
<p><strong>TPS 的过程包括：客户端请求服务端、服务端内部处理、服务端返回客户端。</strong></p>
<p>例如，访问一个 Index 页面会请求服务器 3 次，包括一次 html，一次 css，一次 js，那么访问这一个页面就会产生一个“T”，产生三个“Q”。</p>
<h2 id="qps-与-tps-区别"><strong>QPS 与 TPS 区别</strong></h2>
<p>QPS基本类似于TPS，但是不同的是，对于一个Web页面的一次访问，形成一个TPS（就做一件事儿，打开Web网页）；但一次Web页面请求，可能产生多次对服务器的请求（html、css、js、images、files等），服务器对这些请求，就可计入QPS之中。每秒查询率QPS是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。</p>
<p>一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。</p>
<p>如果是对一个接口（单场景）压测，且这个接口内部不会再去请求其它接口，那么TPS等于QPS，否则，若这个接口内部还会再去请求其它接口（下载图片、文件等服务器接口），那么 TPS不等于QPS，通常是 QPS会大于TPS</p>
<h2 id="pv"><strong>PV</strong></h2>
<p>page view即页面浏览量</p>
<p>通常是衡量一个网络新闻频道或网站甚至一条网络新闻的主要指标。</p>
<p>用户每一次对网站中的每个页面访问均被记录 1 次。</p>
<p>用户对同一页面的多次刷新，访问量累计。</p>
<p>根据这个特性，刷网站的 PV 就很好刷了。</p>
<p>与 PV 相关的还有 <strong>RV</strong>，即重复访问者数量（repeat visitors）。</p>
<h2 id="uv"><strong>UV</strong></h2>
<p>Unique Visitor 指独立访客访问数，统计1天内访问某站点的用户数(以 cookie 为依据)，一台电脑终端为一个访客。</p>
<h2 id="ip"><strong>IP</strong></h2>
<p>Internet Protocol独立 IP 数</p>
<p>是指 1 天内多少个独立的 IP 浏览了页面，即统计不同的 IP 浏览用户数量。</p>
<p>同一 IP 不管访问了几个页面，独立 IP 数均为 1；</p>

    
    <div class="card-actions justify-between items-center mt-4">
      
        <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">cuitpanfei</span>
    
  
  </span>
</div>

      

      <div class="flex items-center">
        <ion-icon name="time" class="mr-1"></ion-icon>
        <span>2 minute read</span>
      </div>
    </div>
  </div>
</a>

        </div>
      
    </div>
    

    
    <div class="flex justify-center pt-8">
      <div class="join grid grid-cols-2">
  
  <a href="/categories/page/8/" title=Previous&#32;page class="join-item btn btn-outline btn-sm">
    Previous page
  </a>
  
  
  <a href="/categories/page/10/" title="Next page" class="join-item btn btn-outline btn-sm">
    Next page
  </a>
  
</div>

    </div>
    
  </div>
</div>



            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
  <p>© 2025 Cuitpanfei Site</p>
  

  
  <p class="text-sm">
    🌱
    <span class="text-base-content/60">
      Powered by <a class="hover:underline" href="https://gohugo.io/" target="_blank">Hugo</a> with theme
      <a class="hover:underline" href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</span
    >
  </p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
        <div class="back">
          <div class="container">
            
            <div class="dream-grid dream-grid-about">
  

  

  
</div>

            

            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
  <p>© 2025 Cuitpanfei Site</p>
  

  
  <p class="text-sm">
    🌱
    <span class="text-base-content/60">
      Powered by <a class="hover:underline" href="https://gohugo.io/" target="_blank">Hugo</a> with theme
      <a class="hover:underline" href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</span
    >
  </p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
      </div>
    </div>

    <script>
  window.lightTheme =  null 
  window.darkTheme =  null 
</script>


  <script src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>

  
  
  <script src="/js/grid.js"></script>




<script src="/js/main.js"></script>

    





    

    

    

    

    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js" integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin="anonymous"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js" integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin="anonymous"></script>
  </body>
</html>
